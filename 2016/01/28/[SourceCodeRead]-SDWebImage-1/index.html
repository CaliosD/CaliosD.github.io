<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Stedfast as thou art."><title>[SourceCodeRead] SDWebImage-1 | Calios' Eden</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/6.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">[SourceCodeRead] SDWebImage-1</h1><a id="logo" href="/.">Calios' Eden</a><p class="description">Stedfast as thou art.</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> é¦–é¡µ</i></a><a href="/archives/"><i class="fa fa-archive"> å½’æ¡£</i></a><a href="/about/"><i class="fa fa-user"> å…³äº</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">[SourceCodeRead] SDWebImage-1</h1><div class="post-meta">Jan 28, 2016<script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> é˜…è¯»</span></span></div><div class="post-content"><p><a href="https://github.com/rs/SDWebImage" title="https://github.com/rs/SDWebImage" target="_blank" rel="external">SDWebImage</a>ä½œä¸ºä¸€ä¸ªå°†æœåŠ¡å™¨è¿œç¨‹çš„å›¾ç‰‡è·å–åˆ°UIImageViewä¸Šæ˜¾ç¤ºçš„ä¸€ä¸ªç¬¬ä¸‰æ–¹ç±»åº“ï¼Œäºæˆ‘è€Œè¨€ï¼Œæœ€ä¸ºå¸¸ç”¨çš„APIè«è¿‡äº<code>-sd_setImageWithURL: placeholderImage:</code>æ–¹æ³•ã€‚ä¸å¦¨ä»¥æ­¤å…¥æ‰‹ï¼Œæ‹¨å¼€å®ƒæºä»£ç çš„ç¥ç§˜é¢çº±ã€‚</p>
<hr>
<p><img src="http://7xkwcv.com1.z0.glb.clouddn.com/QQ20160506-0.png" alt="" title="UIImage+WebCache.mç‰‡æ®µ"></p>
<p>ç‚¹å…¥.mæ–‡ä»¶ï¼Œå‘ç°ä¸Šå›¾ä¸­ä»ä¸Šè‡³ä¸‹çš„ä¸€åˆ—æ–¹æ³•ï¼Œéƒ½ä¾æ¬¡æŒ‡å‘ç›¸é‚»çš„ä¸‹ä¸€ä¸ªæ–¹æ³•ï¼Œä¸è¿‡åœ¨ä¸Šå±‚è°ƒç”¨æ—¶ä¸ªåˆ«å‚æ•°ç½®ä¸º<code>nil</code>æˆ–<code>0</code>ã€‚ç›´åˆ°<code>-sd_setImageWithURL: placeholderImage:options:progress:completed:</code>è¿™ä¸ª<strong>æ ¸å¿ƒæ–¹æ³•</strong>ï¼Œæ–¹è§ç«¯å€ªã€‚<br><figure class="highlight erlang"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">- <span class="params">(void)</span>sd_setImageWithURL:<span class="params">(NSURL *)</span>url placeholderImage:<span class="params">(UIImage *)</span>placeholder options:<span class="params">(SDWebImageOptions)</span>options progress:<span class="params">(SDWebImageDownloaderProgressBlock)</span>progressBlock completed:<span class="params">(SDWebImageCompletionBlock)</span>completedBlock &#123;</div><div class="line">    [self sd_cancelCurrentImageLoad];</div><div class="line">    objc_setAssociatedObject<span class="params">(self, &amp;imageURLKey, url, OBJC_ASSOCIATION_RETAIN_NONATOMIC)</span>; // [1]</div><div class="line"></div><div class="line">    if <span class="params">(!(options &amp; SDWebImageDelayPlaceholder)</span>) &#123; // [2]</div><div class="line">        dispatch_main_async_safe<span class="params">(^&#123;</span></div><div class="line">            self.image = placeholder;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">...</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="ï¼»1ï¼½objc-setAssociatedObject"><a href="#ï¼»1ï¼½objc-setAssociatedObject" class="headerlink" title="ï¼»1ï¼½objc_setAssociatedObject"></a>ï¼»1ï¼½objc_setAssociatedObject</h3><h4 id="1-è¿™è´§æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#1-è¿™è´§æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1. è¿™è´§æ˜¯ä»€ä¹ˆï¼Ÿ"></a>1. è¿™è´§æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>æ ¹æ®è‹¹æœçš„<a href="https://developer.apple.com/library/ios/documentation/Cocoa/Reference/ObjCRuntimeRef/#//apple_ref/c/func/objc_setAssociatedObject" title="https://developer.apple.com/library/ios/documentation/Cocoa/Reference/ObjCRuntimeRef/#//apple_ref/c/func/objc_setAssociatedObject" target="_blank" rel="external">å®˜æ–¹æ–‡æ¡£</a>ï¼š</p>
<blockquote>
<p><code>objc_setAssociatedObject</code>æ˜¯Objectiveï¼Cè¿è¡Œæ—¶çš„ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒå¯ä»¥å°†ä¸¤ä¸ªå¯¹è±¡å…³è”èµ·æ¥ã€‚è¿™ä¸ªå‡½æ•°éœ€è¦å››ä¸ªå‚æ•°ï¼šåŸå¯¹è±¡ï¼Œä¸€ä¸ªé”®ï¼Œä¸€ä¸ªå€¼ï¼Œå’Œä¸€ä¸ªå…³è”ç­–ç•¥çš„å¸¸é‡ã€‚å…¶ä¸­ï¼Œé”®æ˜¯ä¸€ä¸ªvoidæŒ‡é’ˆã€‚</p>
<ul>
<li>æ¯ä¸ªå…³è”çš„é”®éƒ½å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚é€šå¸¸çš„åšæ³•æ˜¯ä½¿ç”¨ä¸€ä¸ªé™æ€å˜é‡ã€‚</li>
<li>å…³è”ç­–ç•¥æŒ‡å®šäº†è¢«å…³è”çš„å¯¹è±¡æ˜¯assignedï¼Œretainedï¼Œcopiedè¿˜æ˜¯atomic/nonatomicã€‚è¿™ä¸ªå½¢å¼å’Œå£°æ˜propertyæ˜¯ç±»ä¼¼çš„ã€‚å¯ä»¥ç”¨å¸¸é‡æ¥æŒ‡å®šè¿™ç§å…³ç³»ã€‚</li>
</ul>
</blockquote>
<h4 id="2-ä»€ä¹ˆåœºæ™¯ä¸‹ä¼šä½¿ç”¨ï¼Ÿ"><a href="#2-ä»€ä¹ˆåœºæ™¯ä¸‹ä¼šä½¿ç”¨ï¼Ÿ" class="headerlink" title="2. ä»€ä¹ˆåœºæ™¯ä¸‹ä¼šä½¿ç”¨ï¼Ÿ"></a>2. ä»€ä¹ˆåœºæ™¯ä¸‹ä¼šä½¿ç”¨ï¼Ÿ</h4><p><a href="http://stackoverflow.com/a/16313377/1594792" title="http://stackoverflow.com/a/16313377/1594792" target="_blank" rel="external">abbood</a>å°†å®ƒçš„ä½¿ç”¨åœºæ™¯å½’ç»“ä¸ºå¦‚ä¸‹å‡ ç‚¹ï¼š</p>
<p>(1)ç»™ç±»åˆ«ï¼ˆcategoryï¼‰æ·»åŠ å®ä¾‹å˜é‡ã€‚</p>
<p>å‡è®¾ä½ æƒ³ç»™ä½ ä¸èƒ½ä¿®æ”¹çš„å¯¹è±¡ï¼ˆæ¯”å¦‚è¯´è‹¹æœå®˜æ–¹æä¾›çš„å¯¹è±¡ï¼ŒUIImageã€UILabelç¥é©¬çš„ã€‚æ³¨æ„ï¼šæˆ‘ä»¬è¿™é‡Œè®¨è®ºçš„æ˜¯ä¿®æ”¹å¯¹è±¡æœ¬èº«ï¼Œä¸åŒ…æ‹¬å°†å…¶å­ç±»åŒ–ã€‚ï¼‰çš„ç±»åˆ«ä¸­æ·»åŠ ä¸ªè‡ªå®šä¹‰çš„å±æ€§ï¼ˆ<a href="https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/ProgrammingWithObjectiveC/CustomizingExistingClasses/CustomizingExistingClasses.html" title="https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/ProgrammingWithObjectiveC/CustomizingExistingClasses/CustomizingExistingClasses.html" target="_blank" rel="external">è¿™å‡ ä¹æ˜¯Objective-Cæœ€å¤§çš„ç¼ºç‚¹</a>ï¼‰ï¼Œæ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬æƒ³ç»™<code>UIImage</code>æ·»åŠ ä¸€ä¸ªtitleçš„å±æ€§ã€‚</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// UIImage-Title.h:</span></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">UIImage</span>(<span class="title">Title</span>)</span></div><div class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *title;</div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="comment">// UIImage-Title.m:</span></div><div class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></div><div class="line"><span class="meta">#import <span class="meta-string">&lt;objc/runtime.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">char</span> titleKey;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">UIImage</span>(<span class="title">Title</span>)</span></div><div class="line">- (<span class="built_in">NSString</span> *)title</div><div class="line">&#123;</div><div class="line">    <span class="keyword">return</span> objc_getAssociatedObject(<span class="keyword">self</span>, &amp;titleKey);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)setTitle:(<span class="built_in">NSString</span> *)title</div><div class="line">&#123;</div><div class="line">    objc_setAssociatedObject(<span class="keyword">self</span>, &amp;titleKey, title, OBJC_ASSOCIATION_COPY);</div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p>(2)åŠ¨æ€åœ°ç»™å¯¹è±¡æ·»åŠ çŠ¶æ€ä¿¡æ¯ï¼Œè€Œè¿™ä¸ªå¯¹è±¡çš„å®ä¾‹å˜é‡å³ä¾¿ç»“åˆKVOä¹Ÿä¸èƒ½è¾¾åˆ°ç›®çš„ã€‚ï¼ˆæœ‰ç‚¹æ‹—å£ï¼Œæ…¢æ…¢ç†è§£ã€‚ã€‚ï¼‰</p>
<p>æ„æ€æ˜¯è¯´ï¼Œä½ çš„å¯¹è±¡åªæœ‰åœ¨runtimeæœŸé—´ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼ŒåŠ¨æ€åœ°ï¼‰æ‰èƒ½è·å–çŠ¶æ€ä¿¡æ¯ã€‚æ‰€ä»¥ï¼Œå°½ç®¡ä½ å¯ä»¥æŠŠçŠ¶æ€ä¿¡æ¯å­˜åœ¨å®ä¾‹å˜é‡ä¸­ï¼Œä½†å®é™…ä¸Šä½ æ˜¯è¦åœ¨runtimeæœŸé—´æŠŠè¿™ä¸ªä¿¡æ¯å’Œå¯¹è±¡ç»‘å®šèµ·æ¥ã€å¹¶ä¸”åŠ¨æ€åœ°æŠŠå®ƒå’Œå¦ä¸€ä¸ªå¯¹è±¡å…³è”ï¼Œè¦å¼ºè°ƒçš„æ˜¯<strong>è¿™æ˜¯ä¸€ä¸ªå¯¹è±¡çš„åŠ¨æ€çŠ¶æ€</strong>è¿™ä¸ªäº‹å®ã€‚</p>
<p>å¦‚ä¸‹æ˜¯ä¸€ä¸ªä¸é”™çš„<a href="https://github.com/alexzielenski/ZKRevealingTableViewCell/blob/master/vendor/ZKRevealingTableViewCell.m" title="https://github.com/alexzielenski/ZKRevealingTableViewCell/blob/master/vendor/ZKRevealingTableViewCell.m" target="_blank" rel="external">ä¾‹å­</a>ä¸­çš„ä¸€ä¸ªç‰‡æ®µï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå…³è”å¯¹è±¡ä½¿ç”¨äº†KVOé€šçŸ¥ï¼Œä½†KVOå¹¶ä¸æ˜¯å…³è”å¯¹è±¡çš„å¿…è¦æ¡ä»¶ã€‚</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">static</span> <span class="keyword">char</span> BOOLRevealing;</div><div class="line"></div><div class="line">- (<span class="built_in">BOOL</span>)isRevealing</div><div class="line">&#123;</div><div class="line">    <span class="keyword">return</span> [(<span class="built_in">NSNumber</span>*)objc_getAssociatedObject(<span class="keyword">self</span>, &amp;BOOLRevealing) boolValue];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)_setRevealing:(<span class="built_in">BOOL</span>)revealing</div><div class="line">&#123;</div><div class="line">    [<span class="keyword">self</span> willChangeValueForKey:<span class="string">@"isRevealing"</span>];</div><div class="line">    objc_setAssociatedObject(<span class="keyword">self</span>, &amp;BOOLRevealing,</div><div class="line">       [<span class="built_in">NSNumber</span> numberWithBool:revealing], OBJC_ASSOCIATION_RETAIN_NONATOMIC);</div><div class="line">    [<span class="keyword">self</span> didChangeValueForKey:<span class="string">@"isRevealing"</span>];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¼•ä¸€æ®µ<em>SDWebImage</em>ä¸­çš„ä»£ç ï¼Œçº¯æ­£çš„ã€ä¸å«KVOçš„é•¿è¿™æ ·å­ï¼š<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)setShowActivityIndicatorView:(<span class="built_in">BOOL</span>)show&#123;</div><div class="line">    objc_setAssociatedObject(<span class="keyword">self</span>, &amp;TAG_ACTIVITY_SHOW, [<span class="built_in">NSNumber</span> numberWithBool:show], OBJC_ASSOCIATION_RETAIN);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="built_in">BOOL</span>)showActivityIndicatorView&#123;</div><div class="line">    <span class="keyword">return</span> [objc_getAssociatedObject(<span class="keyword">self</span>, &amp;TAG_ACTIVITY_SHOW) boolValue];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å…¶ä¸­ï¼Œ<code>TAG_ACTIVITY_SHOW</code>çš„å®šä¹‰å¦‚ä¸‹ï¼š<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">static</span> <span class="keyword">char</span> TAG_ACTIVITY_SHOW;</div></pre></td></tr></table></figure></p>
<h4 id="3-æ­¤å¤„ä½œç”¨"><a href="#3-æ­¤å¤„ä½œç”¨" class="headerlink" title="3. æ­¤å¤„ä½œç”¨"></a>3. æ­¤å¤„ä½œç”¨</h4><p>æ‰€ä»¥ï¼Œè¿™é‡Œç›¸å½“äºç»™UIImageViewçš„categoryæ·»åŠ äº†ä¸€ä¸ª<code>imageURLKey</code>çš„å±æ€§ï¼Œæˆ‘çŒœæƒ³ï¼Œæ˜¯ç”¨æ¥è¡¨ç¤ºå›¾ç‰‡èµ„æºçš„å”¯ä¸€æ€§çš„keyã€‚</p>
<h3 id="ï¼»2ï¼½-amp"><a href="#ï¼»2ï¼½-amp" class="headerlink" title="ï¼»2ï¼½&amp;"></a>ï¼»2ï¼½&amp;</h3><h4 id="ä¸ºä»€ä¹ˆè¿™é‡Œç”¨-amp-è€Œä¸æ˜¯-amp-amp-å‘¢ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¿™é‡Œç”¨-amp-è€Œä¸æ˜¯-amp-amp-å‘¢ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¿™é‡Œç”¨&amp;è€Œä¸æ˜¯&amp;&amp;å‘¢ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¿™é‡Œç”¨<code>&amp;</code>è€Œä¸æ˜¯<code>&amp;&amp;</code>å‘¢ï¼Ÿ</h4><p>è¶æœºæ¡ä¸€æ¡åŸºç¡€çŸ¥è¯†ï¼š</p>
<p><code>&amp;</code>æ˜¯æŒ‰ä½è¿ç®—çš„åŒç›®è¿ç®—ç¬¦ï¼ŒåŠŸèƒ½æ˜¯å‚ä¸å°†è¿ç®—çš„ä¸¤ä¸ªæ•°å„è‡ªå¯¹åº”çš„äºŒè¿›ä½ç›¸ä¸ã€‚<br>ä¾‹å¦‚ï¼š9&amp;5å¯ä»¥å†™ç®—å¼ï¼š00001001 &amp; 00000101 ï¼ 00000001ï¼Œå³ 9 &amp; 5 = 1ã€‚</p>
<p><code>&amp;&amp;</code>æ£€æŸ¥ç¬¬ä¸€ä¸ªæ“ä½œæ•°çš„å€¼ï¼Œå¦‚æœä¸ºfalseï¼Œå°±ä¸å†å¤„ç†ç¬¬äºŒä¸ªæ“ä½œæ•°ï¼Œç›´æ¥è¿”å›falseã€‚</p>
<p>æ‰€ä»¥ï¼Œè¿™é‡Œçš„<code>(options &amp; SDWebImageDelayPlaceholder)</code>ï¼Œæ˜¯ä¸¤ä¸ªæšä¸¾å€¼è¿›è¡ŒæŒ‰ä½è¿ç®—ï¼Œè€Œéæˆ‘ä»¬å¹³å¸¸å†™çš„true/falseçš„å¸ƒå°”åˆ¤æ–­ã€‚</p>
<p>éšæ‰‹ç‚¹å…¥æšä¸¾å€¼çš„å®šä¹‰ï¼Œå‘ç°è¿™ä¸€å †ï¼š<br><figure class="highlight elm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">typedef <span class="type">NS_OPTIONS</span>(<span class="type">NSUInteger</span>, <span class="type">SDWebImageOptions</span>) &#123;</div><div class="line">    /**</div><div class="line">     * <span class="type">By</span> default, when a <span class="type">URL</span> fail to be downloaded, the <span class="type">URL</span> is blacklisted so the library won't keep trying.</div><div class="line">     * <span class="type">This</span> flag disable this blacklisting.</div><div class="line">     */</div><div class="line">    <span class="type">SDWebImageRetryFailed</span> = 1 &lt;&lt; 0, // [3]</div><div class="line"></div><div class="line">    /**</div><div class="line">     * <span class="type">By</span> default, image downloads are started during <span class="type">UI</span> interactions, this flags disable this feature,</div><div class="line">     * leading to delayed download on <span class="type">UIScrollView</span> deceleration for instance.</div><div class="line">     */</div><div class="line">    <span class="type">SDWebImageLowPriority</span> = 1 &lt;&lt; 1,</div><div class="line"></div><div class="line">    /**</div><div class="line">     * <span class="type">This</span> flag disables on-disk caching</div><div class="line">     */</div><div class="line">    <span class="type">SDWebImageCacheMemoryOnly</span> = 1 &lt;&lt; 2,</div><div class="line">    ...</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>è€Œå…¶å®<code>SDWebImageDelayPlaceholder</code>æ­£æ˜¯è¿™ä¸€ç¾¤æšä¸¾å€¼ä¸­çš„ä¸€ä¸ªã€‚æ‰€ä»¥çŒœæµ‹ï¼Œè¿™å¥ä»£ç çš„æ„æ€æ˜¯è¯´ï¼Œä¼ å…¥çš„<code>option</code>ä¸ºåŒ…å«<code>SDWebImageDelayPlaceholder</code>æ—¶è¯¥å¦‚ä½•å¦‚ä½•â€¦â€¦ï¼ˆå¯ä¸ºå˜›æ›²æ›²æŠ˜æŠ˜åœ°ä¸ç›´è¯´å‘¢ï¼Ÿ=_=|||ï¼‰ ä½†è¿˜æ˜¯æ²¡æœ‰è§£å†³ä¸ºä»€ä¹ˆç”¨<code>&amp;</code>è€Œä¸ç”¨<code>&amp;&amp;</code>çš„é—®é¢˜ã€‚ä»”ç»†ä¸€çœ‹ï¼Œè¿™é‡Œçš„æšä¸¾å¹¶éè‡ªå·±å¹³æ—¶ä½¿ç”¨çš„<code>NS_ENUM</code>ï¼Œè€Œæ˜¯<code>NS_OPTIONS</code>ã€‚ç®€è€Œè¨€ä¹‹ï¼ŒäºŒè€…æœ¬è´¨ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œ<code>NS_ENUM</code>æ˜¯æ¯”è¾ƒé€šç”¨çš„æƒ…å†µï¼Œè€Œä½æ©ç æ—¶ç”¨<code>NS_OPTIONS</code>ï¼Œå…·ä½“çš„è§£é‡Šå¯ä»¥çœ‹<a href="http://nshipster.com/ns_enum-ns_options/" title="http://nshipster.com/ns_enum-ns_options/" target="_blank" rel="external">Matttçš„è¿™ç¯‡</a>ã€‚</p>
<p><strong> â€”â€”â€”â€” 20160216æ›´æ–°â€”â€”â€”â€” </strong><br>é‰´äºåæœŸè¶Šæ¥è¶Šå¤šçš„ä½è¿ç®—å‡ºç°ï¼Œè¿‡æœŸçš„è–„åº•å­holdä¸ä½äº†ã€‚è¿™é‡Œä¸¾ä¸€ä¸ªä¾‹å­ï¼Œæ›´å¤šè¯¦ç»†ä»‹ç»å‚è€ƒ<a href="http://www.cnblogs.com/cute/p/3786283.html" title="http://www.cnblogs.com/cute/p/3786283.html" target="_blank" rel="external">è¿™ç¯‡</a>ã€‚<br><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">typedef NS_OPTIONS(NSUInteger, MyOption) &#123;</div><div class="line">    MyOptionNone = <span class="number">0</span>, <span class="comment">//äºŒè¿›åˆ¶0000,åè¿›åˆ¶0</span></div><div class="line">    MyOption1 = <span class="number">1</span> &lt;&lt; <span class="number">0</span>,<span class="comment">//0001,1</span></div><div class="line">    MyOption2 = <span class="number">1</span> &lt;&lt; <span class="number">1</span>,<span class="comment">//0010,2</span></div><div class="line">    MyOption3 = <span class="number">1</span> &lt;&lt; <span class="number">2</span>,<span class="comment">//0100,4</span></div><div class="line">    MyOption4 = <span class="number">1</span> &lt;&lt; <span class="number">3</span>,<span class="comment">//1000,8</span></div><div class="line">&#125;;</div><div class="line">##ä½¿ç”¨:</div><div class="line"><span class="comment">//å£°æ˜å®šä¹‰æšä¸¾å˜é‡</span></div><div class="line">MyOption option = MyOption1 | MyOption2;<span class="comment">//0001 | 0010 = 0011,3</span></div><div class="line"></div><div class="line"><span class="comment">//æ£€æŸ¥æ˜¯å¦åŒ…å«æŸé€‰å‹</span></div><div class="line">if ( <span class="keyword">option</span> &amp; MyOption3 )&#123; <span class="comment">//0011 &amp; 0100 = 0000</span></div><div class="line">     <span class="comment">//åŒ…å«MyOption3</span></div><div class="line">&#125;else&#123;</div><div class="line">     <span class="comment">//ä¸åŒ…å«MyOption3</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//å¢åŠ é€‰é¡¹:</span></div><div class="line"><span class="keyword">option</span> = <span class="keyword">option</span> | MyOption4;<span class="comment">//0011 | 1000 = 1011, 11</span></div><div class="line"><span class="comment">//å‡å°‘é€‰é¡¹</span></div><div class="line"><span class="keyword">option</span> = <span class="keyword">option</span> &amp; (~MyOption4);<span class="comment">//1011 &amp; (~1000) = 1011 &amp; 0111 = 0011, 3</span></div></pre></td></tr></table></figure></p>
<p>æˆ‘çš„ç†è§£æ˜¯ï¼ŒBitwise <code>AND</code>ï¼Œå³<code>&amp;</code>ï¼Œç›¸å½“äºä¸¤ä¸ªoptionå–äº¤é›†ï¼›Bitwise <code>OR</code>ï¼Œå³<code>|</code>ï¼Œç›¸å½“äºä¸¤ä¸ªoptionå–å¹¶é›†ã€‚</p>
<p>å…³äº<code>NS_OPTIONS</code>å’Œ<code>NS_ENUM</code>çš„å·®åˆ«ï¼Œåæ¥æŸ¥åˆ°çš„orkodençš„<a href="http://stackoverflow.com/a/21384671/1594792" target="_blank" rel="external">å›ç­”</a>ä¸€è¯­ä¸­çš„ğŸ˜‚ï¼š</p>
<blockquote>
<p>Thereâ€™s a basic difference between an enum and a bitmask (option). You use an enum to list exclusive states. A bitmask is used when several properties can apply at the same time.</p>
</blockquote>
<p><strong> â€”â€”â€”â€” 20160216æ›´æ–°ç»“æŸâ€”â€”â€”â€” </strong></p>
<h3 id="ï¼»3ï¼½-lt-lt"><a href="#ï¼»3ï¼½-lt-lt" class="headerlink" title="ï¼»3ï¼½\&lt;\&lt;"></a>ï¼»3ï¼½\&lt;\&lt;</h3><p><code>&lt;&lt;</code>ä¸ºæŒ‰ä½å·¦ç§»è¿ç®—ç¬¦ã€‚å…·ä½“å®ƒ<a href="http://stackoverflow.com/questions/141525/what-are-bitwise-shift-bit-shift-operators-and-how-do-they-work" title="http://stackoverflow.com/questions/141525/what-are-bitwise-shift-bit-shift-operators-and-how-do-they-work" target="_blank" rel="external">æ˜¯ä»€ä¹ˆä»¥åŠæ€æ ·è¿ç®—</a>ï¼Œè¿™é‡Œç•¥å»ä¸æäº†ã€‚ç®€å•ä¸¾ä¾‹å¦‚ä¸‹ï¼š<br>SDWebImageAvoidAutoSetImage<br>    1 &lt;&lt; 2 å³ äºŒè¿›åˆ¶çš„100 ï¼ åè¿›åˆ¶ 2çš„å¹³æ–¹<br>    1 &lt;&lt; 3 å³ äºŒè¿›åˆ¶çš„1000 ï¼ åè¿›åˆ¶ 2çš„3æ¬¡æ–¹</p>
<p>æ‰€ä»¥ï¼Œ<code>1 &lt;&lt; n</code>ï¼Œå³äºŒè¿›åˆ¶1å·¦ä½ç§»nä½ï¼Œç›¸å½“äºåè¿›åˆ¶2çš„næ¬¡æ–¹ã€‚</p>
<h3 id="ï¼»4ï¼½å®å®šä¹‰"><a href="#ï¼»4ï¼½å®å®šä¹‰" class="headerlink" title="ï¼»4ï¼½å®å®šä¹‰"></a>ï¼»4ï¼½å®å®šä¹‰</h3><p><code>dispatch_main_sync_safe</code>å’Œ<code>dispatch_main_async_safe</code>æ˜¯SDWebImageå®šä¹‰çš„ä¸¤ä¸ªå®ã€‚è‹¥å½“å‰æ˜¯ä¸»çº¿ç¨‹ï¼Œåˆ™æ‰§è¡Œblockï¼›è‹¥ä¸æ˜¯ä¸»çº¿ç¨‹ï¼Œåˆ™åœ¨ä¸»çº¿ç¨‹ä¸­åŒæ­¥/å¼‚æ­¥ä¹‹è¡Œblockã€‚<br><figure class="highlight livescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#define dispatch_main_sync_safe(block)\</span></div><div class="line">    <span class="keyword">if</span> ([NSThread isMainThread]) &#123;<span class="string">\</span></div><div class="line">        block();<span class="string">\</span></div><div class="line">    &#125; <span class="keyword">else</span> &#123;<span class="string">\</span></div><div class="line">        dispatch_sync(dispatch_get_main_queue(), block);<span class="string">\</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line"><span class="comment">#define dispatch_main_async_safe(block)\</span></div><div class="line">    <span class="keyword">if</span> ([NSThread isMainThread]) &#123;<span class="string">\</span></div><div class="line">        block();<span class="string">\</span></div><div class="line">    &#125; <span class="keyword">else</span> &#123;<span class="string">\</span></div><div class="line">        dispatch_async(dispatch_get_main_queue(), block);<span class="string">\</span></div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>æ¯è¡Œåé¢çš„åæ–œæ <code>\</code>è¡¨ç¤ºåœ¨ä¸å½±å“å«ä¹‰çš„æ¡ä»¶ä¸‹æ¢è¡Œï¼Œéœ€æ³¨æ„è¦åœ¨å›è½¦ä¹‹å‰åŠ åæ–œæ <code>\</code>ã€‚</p>
<p>å†çœ‹ä¸€ä¸ªå¸¸è§çš„å®å®šä¹‰ã€‚<br><figure class="highlight lisp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">#define DLog(<span class="name">fmt</span>, ...)    NSLog( @<span class="string">"&lt;%@:(%d)&gt; %s \n ----- %@"</span>, [[NSString stringWithUTF8String<span class="symbol">:__FILE__</span>] lastPathComponent], __LINE__, __func__, [NSString stringWithFormat:(<span class="name">fmt</span>), ##__VA_ARGS__] )</div></pre></td></tr></table></figure></p>
<p>è¿™ä¸ªç”¨äºLogçš„å®å®šä¹‰ä¸­ï¼Œæœ‰è¿™æ ·å‡ ç‚¹éœ€è¦è§£é‡Šçš„ï¼š</p>
<ul>
<li><code>DLog(fmt, ...)</code>çš„ç¬¬äºŒä¸ªå‚æ•°<code>...</code>ã€‚åœ¨å®å®šä¹‰çš„æ—¶å€™ï¼Œå†™ä¸ºâ€¦çš„å‚æ•°è¢«å«åšå¯å˜å‚æ•°(variadic)ï¼Œå…¶ä¸ªæ•°æ˜¯ä¸é™å®šçš„ã€‚åœ¨è¿™é‡Œï¼Œç¬¬ä¸€ä¸ªå‚æ•°fmtå°†è¢«å•ç‹¬å¤„ç†ï¼Œåé¢çš„å‚æ•°å°†è¢«ä½œä¸ºæ•´ä½“çœ‹å¾…ã€‚</li>
<li>é€šå¸¸å‰åè¢«<code>__</code>åŒ…å›´çš„éƒ½æ˜¯é¢„å®šä¹‰å®ã€‚å¦‚è¿™é‡Œçš„<code>__FILE__</code>ï¼ˆå½“å‰æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼‰ï¼Œ<code>__LINE__</code>ï¼ˆåœ¨æ–‡ä»¶ä¸­çš„è¡Œæ•°ï¼‰ï¼Œ<code>__func__</code>ï¼ˆè¯¥å®æ‰€åœ¨çš„è¡Œæ‰€å±çš„å‡½æ•°åï¼‰ã€‚</li>
<li><code>##__VA_ARGS__</code>è¡¨ç¤ºçš„æ˜¯å®å®šä¹‰ä¸­çš„â€¦ä¸­çš„æ‰€æœ‰å‰©ä½™å‚æ•°ã€‚æ‰“å¤´çš„<code>##</code>è¡¨ç¤ºå°†ä¸¤ä¸ªå‚æ•°è¿æ¥èµ·æ¥è¿™ç§è¿ç®—ã€‚</li>
</ul>
<h3 id="ï¼»5ï¼½SDWebImageOptionsä¸­å‡ ä¸ªæœ‰è¶£çš„æšä¸¾å€¼"><a href="#ï¼»5ï¼½SDWebImageOptionsä¸­å‡ ä¸ªæœ‰è¶£çš„æšä¸¾å€¼" class="headerlink" title="ï¼»5ï¼½SDWebImageOptionsä¸­å‡ ä¸ªæœ‰è¶£çš„æšä¸¾å€¼"></a>ï¼»5ï¼½<code>SDWebImageOptions</code>ä¸­å‡ ä¸ªæœ‰è¶£çš„æšä¸¾å€¼</h3><figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">typedef NS_OPTIONS(NSUInteger, SDWebImageOptions) &#123;</div><div class="line">    ...</div><div class="line">    /**</div><div class="line">     * By default, placeholder images are loaded <span class="keyword">while</span> <span class="keyword">the</span> image <span class="keyword">is</span> loading. This flag will <span class="built_in">delay</span> <span class="keyword">the</span> loading</div><div class="line">     * <span class="keyword">of</span> <span class="keyword">the</span> placeholder image <span class="keyword">until</span> <span class="keyword">after</span> <span class="keyword">the</span> image has finished loading.</div><div class="line">     */</div><div class="line">    SDWebImageDelayPlaceholder = <span class="number">1</span> &lt;&lt; <span class="number">9</span>,</div><div class="line">    ...</div><div class="line">        /**</div><div class="line">     * By default, image <span class="keyword">is</span> added <span class="keyword">to</span> <span class="keyword">the</span> imageView <span class="keyword">after</span> download. But <span class="keyword">in</span> <span class="keyword">some</span> cases, we want <span class="keyword">to</span></div><div class="line">     * have <span class="keyword">the</span> hand <span class="keyword">before</span> setting <span class="keyword">the</span> image (apply a filter <span class="keyword">or</span> add <span class="keyword">it</span> <span class="keyword">with</span> cross-fade animation <span class="keyword">for</span> instance)</div><div class="line">     * Use this flag <span class="keyword">if</span> you want <span class="keyword">to</span> manually <span class="keyword">set</span> <span class="keyword">the</span> image <span class="keyword">in</span> <span class="keyword">the</span> completion when success</div><div class="line">     */</div><div class="line">    SDWebImageAvoidAutoSetImage = <span class="number">1</span> &lt;&lt; <span class="number">11</span></div></pre></td></tr></table></figure>
<p>åœ¨ä¸Šé¢æåˆ°çš„<strong>æ ¸å¿ƒæ–¹æ³•</strong>ä¸­ï¼Œæœ‰è¿™æ ·å‡ ä¸ª<code>SDWebImageOptions</code>å¼•èµ·äº†æˆ‘çš„æ³¨æ„ã€‚</p>
<p>ä¸€ä¸ªæ˜¯<code>SDWebImageDelayPlaceholder</code>ã€‚è¯´æ˜¯é»˜è®¤æƒ…å†µä¸‹ï¼Œplaceholderçš„å›¾ç‰‡ä¼šåœ¨ç½‘ç»œå›¾ç‰‡åŠ è½½çš„è¿‡ç¨‹ä¸­å°±è¢«åŠ è½½å®Œæ¯•ï¼Œè¿™ä¸ªflagä¼šå°†placeholderå›¾ç‰‡ç­‰åŠ è½½å»¶è¿Ÿåˆ°ç½‘ç»œå›¾ç‰‡å®ŒæˆåŠ è½½ä¹‹åã€‚æ‰€ä»¥è¿™é‡Œ<br><figure class="highlight arduino"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">if</span> (!(options &amp; SDWebImageDelayPlaceholder)) &#123; <span class="comment">// [2]</span></div><div class="line">    dispatch_main_async_safe(^&#123;</div><div class="line">        self.<span class="built_in">image</span> = placeholder;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>æ˜¯è¯´å¦‚æœä½¿ç”¨è€…ä¼ å…¥çš„<code>options</code>ä¸æ˜¯<code>SDWebImageDelayPlaceholder</code>ï¼Œå°±æ­£å¸¸åœ°æŠŠplaceholderå›¾ç‰‡èµ‹ç»™å½“å‰çš„<code>imageView</code>ã€‚ä¹‹å‰ç¬¬ä¸€éçœ‹æ—¶æ²¡æœ‰çœ‹æ‡‚ï¼ŒåŸæ¥å°±æ˜¯â€œè´Ÿè´Ÿå¾—æ­£â€çš„æ„æ€ã€‚</p>
<p>å¦ä¸€ä¸ªæ˜¯<code>SDWebImageAvoidAutoSetImage</code>ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå›¾ç‰‡ä¼šåœ¨ä¸‹è½½å®Œæ¯•å<em>è‡ªåŠ¨</em>æ·»åŠ ç»™<code>imageView</code>ã€‚ä½†æœ‰äº›æ—¶å€™ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬æƒ³åœ¨è®¾ç½®å›¾ç‰‡ä¹‹å‰åŠ ä¸€äº›å›¾ç‰‡å¤„ç†ï¼ˆåŠ ä¸ªæ»¤é•œæˆ–è€…æ¸å˜åŠ¨ç”»ä¹‹ç±»çš„ï¼‰ï¼Œå°±éœ€è¦åœ¨ä¸‹è½½æˆåŠŸæ—¶<em>æ‰‹åŠ¨</em>ä½¿ç”¨è¿™ä¸ªflagæ¥è®¾ç½®å›¾ç‰‡äº†ã€‚<strong>ä»¥åæƒ³å®ç°ç±»ä¼¼æ•ˆæœå°±çŸ¥é“è¯¥åœ¨å“ªé‡Œè®¾ç½®ä»€ä¹ˆå‚æ•°äº†ã€‚</strong><br><figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (<span class="built_in">image</span> &amp;&amp; (options &amp; SDWebImageAvoidAutoSetImage) &amp;&amp; completedBlock)</div><div class="line">&#123;</div><div class="line">        completedBlock(<span class="built_in">image</span>, <span class="built_in">error</span>, cacheType, url);</div><div class="line">        <span class="built_in">return</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>æ‰€ä»¥è¿™é‡Œåˆ¤æ–­ï¼Œå¦‚æœimageä¸ä¸ºç©ºï¼Œè€Œ<code>options</code>è¡¨æ˜éœ€è¦å¢åŠ å›¾ç‰‡å¤„ç†ï¼Œä¸”åŠ è½½å®Œæˆçš„<code>completeBlock</code>ä¸ä¸ºç©ºï¼Œé‚£ä¹ˆå°±ä»£å…¥å‚æ•°ï¼Œæ‰§è¡Œ<code>completeBlock</code>ã€‚</p>
<h3 id="ï¼»6ï¼½setNeedsLayoutå’ŒlayoutIfNeeded"><a href="#ï¼»6ï¼½setNeedsLayoutå’ŒlayoutIfNeeded" class="headerlink" title="ï¼»6ï¼½setNeedsLayoutå’ŒlayoutIfNeeded"></a>ï¼»6ï¼½<code>setNeedsLayout</code>å’Œ<code>layoutIfNeeded</code></h3><p>æ¥ç€ä¸Šé¢çš„ifåˆ¤æ–­ï¼š<br><figure class="highlight arduino"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">else</span> <span class="built_in">if</span> (<span class="built_in">image</span>)</div><div class="line">&#123;</div><div class="line">         wself.<span class="built_in">image</span> = <span class="built_in">image</span>;</div><div class="line">         [wself setNeedsLayout];</div><div class="line">&#125;</div><div class="line"><span class="built_in">else</span> &#123;</div><div class="line">          <span class="built_in">if</span> ((options &amp; SDWebImageDelayPlaceholder)) &#123;</div><div class="line">                  wself.<span class="built_in">image</span> = placeholder;</div><div class="line">                  [wself setNeedsLayout];</div><div class="line">          &#125;</div><div class="line"> &#125;</div></pre></td></tr></table></figure></p>
<p>å¦‚æœåä¸¤ä¸ªæ¡ä»¶ä¸­è‡³å°‘æœ‰ä¸€ä¸ªä¸æ»¡è¶³ï¼Œé‚£ä¹ˆå°±ç›´æ¥å°†imageèµ‹ç»™å½“å‰çš„<code>imageView</code>ï¼Œå¹¶è°ƒç”¨<code>setNeedsLayout</code>å°†å…¶æ ‡è®°ä¸ºéœ€è¦é‡æ–°å¸ƒå±€ï¼›å¦‚æœimageä¸ºç©ºï¼Œè€Œ<code>options</code>è¡¨æ˜éœ€è¦å»¶è¿ŸåŠ è½½placeholderå›¾ç‰‡ï¼Œé‚£ä¹ˆå°±å°†placeholderå›¾ç‰‡èµ‹ç»™å½“å‰<code>imageView</code>ï¼Œå¹¶å°†å…¶æ ‡è®°ä¸ºéœ€è¦é‡æ–°å¸ƒå±€ã€‚</p>
<p>ä¸<code>setNeedsLayout</code>ç´§å¯†ç›¸å…³çš„<code>layoutIfNeeded</code>ç”¨äºå®ç°å¸ƒå±€ã€‚æ¯”å¦‚ä½¿ç”¨äº†AutoLayoutçš„<code>UITableViewCell</code>ä¸­ç»å¸¸ä¼šè¿™æ ·äºŒè€…è¿ç€å†™ï¼š<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)layoutSubviews</div><div class="line">&#123;</div><div class="line">    [<span class="meta">super layoutSubviews</span>];</div><div class="line"></div><div class="line">    [<span class="meta">self.contentView setNeedsLayout</span>];</div><div class="line">    [<span class="meta">self.contentView layoutIfNeeded</span>];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å…·ä½“iOSç»˜åˆ¶UIçš„åŸç†åŠæ­¥éª¤ï¼Œè¿™é‡Œç®—æ˜¯ç»™è‡ªå·±æŒ–äº†ä¸ªå‘å§ï¼Œä»¥åçœ‹æ‡‚äº†ã€ç ”ç©¶æ˜ç™½äº†å†æ…¢æ…¢å¡«ä¸Šã€‚</p>
<hr>
<p><strong>Refï¼š</strong></p>
<ul>
<li><p><a href="http://stackoverflow.com/questions/5909412/what-is-objc-setassociatedobject-and-in-what-cases-should-it-be-used/16313377#16313377" target="_blank" rel="external">http://stackoverflow.com/questions/5909412/what-is-objc-setassociatedobject-and-in-what-cases-should-it-be-used/16313377#16313377</a></p>
</li>
<li><p>Matttçš„çœŸè¿¹ï¼š<a href="http://nshipster.com/associated-objects/" target="_blank" rel="external">http://nshipster.com/associated-objects/</a></p>
</li>
<li>ä¸­æ–‡ç‰ˆï¼š<a href="http://nshipster.cn/associated-objects/" target="_blank" rel="external">http://nshipster.cn/associated-objects/</a></li>
<li>å–µç¥è®²è§£å®å®šä¹‰é»‘é­”æ³•çš„ä¸€ç¯‡ï¼š<a href="http://onevcat.com/2014/01/black-magic-in-macro/" target="_blank" rel="external">http://onevcat.com/2014/01/black-magic-in-macro/</a></li>
<li>å…³äºä½è¿ç®—ï¼š<a href="http://www.cnblogs.com/cute/p/3786283.html" target="_blank" rel="external">http://www.cnblogs.com/cute/p/3786283.html</a></li>
</ul>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://www.caliosd.gq/2016/01/28/[SourceCodeRead]-SDWebImage-1/" data-id="cjm3997z1000stmj4fqknz77v" class="article-share-link">åˆ†äº«</a><div class="tags"><a href="/tags/iOS/">iOS</a><a href="/tags/SourceCodeRead/">SourceCodeRead</a></div><div class="post-nav"><a href="/2016/01/31/[SourceCodeRead]-SDWebImage-2/" class="pre">[SourceCodeRead]-SDWebImage-2</a><a href="/2016/01/28/essay-soul-in-programming-170127/" class="next">0127-æ‰€è°“æŠ€æœ¯çŸ¥è¯†ä½“ç³»</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://www.caliosd.gq"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> æ ‡ç­¾</i></div><div class="tagcloud"><a href="/tags/iOS/" style="font-size: 15px;">iOS</a> <a href="/tags/Translation/" style="font-size: 15px;">Translation</a> <a href="/tags/SourceCodeRead/" style="font-size: 15px;">SourceCodeRead</a> <a href="/tags/StillWater/" style="font-size: 15px;">StillWater</a> <a href="/tags/Mac/" style="font-size: 15px;">Mac</a> <a href="/tags/ThoughtInTech/" style="font-size: 15px;">ThoughtInTech</a> <a href="/tags/CaseReview/" style="font-size: 15px;">CaseReview</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> æœ€è¿‘æ–‡ç« </i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/10/26/WWDC-2017-412-Auto-Layout-Techniques-in-IB/">WWDC 2017-412: Auto Layout Techniques in Interface Builder</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/29/memory-management-with-ARC/">iOSçš„å†…å­˜ç®¡ç†ä¹‹ARCéƒ¨åˆ†æ€»ç»“</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/28/copy/">å…³äºcopyçš„å¸¸è§é—®é¢˜</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/30/issue-of-lazy-loading-property/">Issue of lazy loading property</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/12/kvo-kvc-missing-points/">KVO & KVC çŸ¥è¯†ç‚¹å°ç»“</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/23/essay-meituan-salon-170422/">0422-ç¾å›¢æ²™é¾™é¢åŸº</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/19/first-shot-in-WebSocket/">WebSocketåˆæ¢</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/15/notes-for-regex/">Regex Notes</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/12/summary-for-CAS-login-in-iOS/">CASç™»å½•ä¹‹iOSç«¯æ€»ç»“</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/22/gps-and-related/">GPS and related</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright Â© 2018 <a href="/." rel="nofollow">Calios' Eden.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>