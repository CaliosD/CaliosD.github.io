<!DOCTYPE html>
<html lang="en">
  <head><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="description" content="Stedfast as thou art."/><link rel="alternate" href="/atom.xml" title="Calios' Eden"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.11.0" />
<link rel="canonical" href="http://www.caliosd.gq/page/5/"/>

<link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css" />
<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.11.0" />

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-71292392-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-71292392-1');
</script><script id="baidu_push">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<script>
  window.config = {"leancloud":{"app_id":null,"app_key":null},"toc":true,"fancybox":true,"pjax":"","latex":false};
</script>

    <title>Calios' Eden</title>
  <link rel="alternate" href="/atom.xml" title="Calios' Eden" type="application/atom+xml">
</head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">Calios' Eden</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list"><a href="/">
        <li class="mobile-menu-item">Home
          </li>
      </a><a href="/archives/">
        <li class="mobile-menu-item">Archives
          </li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags
          </li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About
          </li>
      </a></ul>
</nav>
<div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">Calios' Eden</a>
</div>

<nav class="site-navbar"><ul id="menu" class="menu"><li class="menu-item">
          <a class="menu-item-link" href="/">
            Home
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            Archives
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/tags/">
            Tags
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/about/">
            About
            </a>
        </li>
      </ul></nav>
</header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content"><section id="posts" class="posts"><article class="post">
    <header class="post-header">
      <h1 class="post-title"><a class="post-link" href="/2016/05/17/rich-text-solutions-in-iOS/">iOS上富文本的解决方案</a>
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2016-05-17
        </span></div>
    </header>

    <div class="post-content"><h3 id="简述"><a href="#简述" class="headerlink" title="简述"></a>简述</h3><p>富文本无非要实现两类效果：</p>
<ul>
<li>图片和文字的混排</li>
<li>文字样式的随意修改</li>
</ul>
<h3 id="实现方式"><a href="#实现方式" class="headerlink" title="实现方式"></a>实现方式</h3><ul>
<li>通过CoreText/TextKit来原生实现</li>
<li>通过webView来间接实现</li>
</ul>
<h3 id="具体实现"><a href="#具体实现" class="headerlink" title="具体实现"></a>具体实现</h3><p>一图胜千言：<br><img src="http://7xkwcv.com1.z0.glb.clouddn.com/iOS%E4%B8%8A%E5%AF%8C%E6%96%87%E6%9C%AC%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88.png" alt=""></p>
<h4 id="通过CoreText-TextKit来原生实现"><a href="#通过CoreText-TextKit来原生实现" class="headerlink" title="通过CoreText/TextKit来原生实现"></a>通过CoreText/TextKit来原生实现</h4><p> iOS 6之前：CoreText,纯C语言,极其蛋疼<br> iOS 6开始：NSAttributedString,简单易用<br> iOS 7开始：TextKit,功能强大,简单易用</p>
<p><strong>对于NSAttributedString（iOS6开始）：</strong></p>
<ul>
<li>可以给指定范围（range）内的string添加属性（见UIKit中的<code>NSAttributedString.h</code>中的属性列表）；</li>
<li>可以使用它的类方法<code>attributedStringWithAttachment:</code>，将图片以附件（<code>NSTextAttachment</code>）的形式附加在已有NSAttributedString的后面。</li>
</ul>
<p><strong>对于TextKit（iOS7开始）：</strong></p>
<ul>
<li>可以通过继承<code>NSTextStorage</code>或<code>NSLayoutManager</code>来对不同的样式（如指定文字的高亮、背景颜色、下划线等）进行自定义处理；</li>
<li>可以设置<code>NSTextContainer</code>的<code>exclusionPaths</code>属性来设置镂空区域。</li>
</ul>
<p><strong>对于DTCoreText：</strong></p>
<ul>
<li>对CoreText进行了封装；</li>
<li>可以将html转换成<code>NSAttributedString</code>，而依然以<strong>html的样式</strong>展示出来；</li>
<li>支持CSS样式的展示；</li>
<li>支持内嵌html5视频及播放；</li>
<li>支持对多种附件（图片、视频等）的自定义处理；</li>
<li>支持远程图片等懒加载。</li>
</ul>
<p><strong>补充：</strong></p>
<p>正如<a href="http://stackoverflow.com/questions/4217820/convert-html-to-nsattributedstring-in-ios/18886718#18886718" target="_blank" rel="external">pix</a>所说，iOS7起，UIKit中添加了<code>initWithData:options:documentAttributes:error:</code>方法，可以用HTML来初始化一个NSAttributedString对象。如下：<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[[<span class="built_in">NSAttributedString</span> alloc] initWithData:[htmlString dataUsingEncoding:<span class="built_in">NSUTF8StringEncoding</span>]</div><div class="line">                                 options:@&#123;<span class="built_in">NSDocumentTypeDocumentAttribute</span>: <span class="built_in">NSHTMLTextDocumentType</span>,</div><div class="line">                                           <span class="built_in">NSCharacterEncodingDocumentAttribute</span>: @(<span class="built_in">NSUTF8StringEncoding</span>)&#125;</div><div class="line">                      documentAttributes:<span class="literal">nil</span> error:<span class="literal">nil</span>];</div></pre></td></tr></table></figure></p>
<p>但从评论中来看，普遍反映执行起来花费时间很长。所以类似情况，还是优先考虑使用DTCoreText。</p>
<hr>
<p><strong>Ref:</strong></p>
<ul>
<li>CoreText教程：<a href="https://www.raywenderlich.com/4147/core-text-tutorial-for-ios-making-a-magazine-app" target="_blank" rel="external">https://www.raywenderlich.com/4147/core-text-tutorial-for-ios-making-a-magazine-app</a></li>
<li>DTCoreText: <a href="https://github.com/Cocoanetics/DTCoreText" target="_blank" rel="external">https://github.com/Cocoanetics/DTCoreText</a></li>
<li>DTCoreText-Demo: <a href="https://github.com/yoon-boom/DTCoreText-DEMO" target="_blank" rel="external">https://github.com/yoon-boom/DTCoreText-DEMO</a>(Happy to find an executable one!)</li>
<li>DTCoreText的源码分析：<a href="http://blog.cnbang.net/tech/2630/" target="_blank" rel="external">http://blog.cnbang.net/tech/2630/</a></li>
<li>TextKit教程：<a href="https://www.raywenderlich.com/50151/text-kit-tutorial" target="_blank" rel="external">https://www.raywenderlich.com/50151/text-kit-tutorial</a></li>
<li>YYText：<a href="https://github.com/ibireme/YYText" target="_blank" rel="external">https://github.com/ibireme/YYText</a></li>
<li><a href="http://stackoverflow.com/questions/4217820/convert-html-to-nsattributedstring-in-ios/18886718#18886718" target="_blank" rel="external">http://stackoverflow.com/questions/4217820/convert-html-to-nsattributedstring-in-ios/18886718#18886718</a></li>
</ul>
<h4 id="通过webView来间接实现"><a href="#通过webView来间接实现" class="headerlink" title="通过webView来间接实现"></a>通过webView来间接实现</h4><p>原理是类似symfony中的twig模板，将设计好的模板存在项目中（.mustache和.html），字体保存为.ttf，然后每次请求数据时，将服务器返回的html用这个模板进行渲染，再用嵌入的webview加载，从而得到整体风格一致的页面。</p>
<p>具体实现可以参考开源中国iOS版本的源码。</p>
<hr>
<p><strong>Ref:</strong></p>
<ul>
<li>GRMustache：<a href="https://github.com/groue/GRMustache" target="_blank" rel="external">https://github.com/groue/GRMustache</a></li>
<li><a href="https://github.com/syntaxhighlighter/syntaxhighlighter" target="_blank" rel="external">https://github.com/syntaxhighlighter/syntaxhighlighter</a></li>
<li>开源中国iOS版本源码：<a href="http://git.oschina.net/oschina/iphone-app/tree/master" target="_blank" rel="external">http://git.oschina.net/oschina/iphone-app/tree/master</a></li>
</ul>

        </div></article>
      <article class="post">
    <header class="post-header">
      <h1 class="post-title"><a class="post-link" href="/2016/05/10/how-to-check-if-UITextField-UITextView-is-empty/">How to check if UITextField/UITextView is empty?</a>
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2016-05-10
        </span></div>
    </header>

    <div class="post-content"><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//============================================================</span></div><div class="line"><span class="comment">// Responders that implement the UIKeyInput protocol will be driven by the system-provided keyboard,</span></div><div class="line"><span class="comment">// which will be made available whenever a conforming responder becomes first responder.</span></div><div class="line"></div><div class="line"><span class="built_in">NS_ASSUME_NONNULL_BEGIN</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">UIKeyInput</span> &lt;<span class="title">UITextInputTraits</span>&gt;</span></div><div class="line"></div><div class="line">- (<span class="built_in">BOOL</span>)hasText;</div><div class="line">- (<span class="keyword">void</span>)insertText:(<span class="built_in">NSString</span> *)text;</div><div class="line">- (<span class="keyword">void</span>)deleteBackward;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">UITextInput</span> &lt;<span class="title">UIKeyInput</span>&gt;</span></div><div class="line"></div><div class="line"><span class="built_in">NS_CLASS_AVAILABLE_IOS</span>(<span class="number">2</span>_0) <span class="class"><span class="keyword">@interface</span> <span class="title">UITextField</span> : <span class="title">UIControl</span> &lt;<span class="title">UITextInput</span>, <span class="title">NSCoding</span>&gt;</span></div><div class="line"></div><div class="line"><span class="built_in">NS_CLASS_AVAILABLE_IOS</span>(<span class="number">2</span>_0) <span class="class"><span class="keyword">@interface</span> <span class="title">UITextView</span> : <span class="title">UIScrollView</span> &lt;<span class="title">UITextInput</span>&gt;</span></div></pre></td></tr></table></figure>
<p>In short, have a look at this image.</p>
<p><img src="http://7xkwcv.com1.z0.glb.clouddn.com/How%20to%20check%20if%20UITextField:UITextView%20is%20empty@2x.png" alt=""></p>
<p>So, just call <code>[yourTextField hasText]</code> or <code>[yourTextView hasText]</code> and everything is done!</p>

        </div></article>
      <article class="post">
    <header class="post-header">
      <h1 class="post-title"><a class="post-link" href="/2016/05/04/UITableView／UICollectionView-with-empty-data/">UITableView／UICollectionView with empty data</a>
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2016-05-04
        </span></div>
    </header>

    <div class="post-content"><h5 id="Use-case"><a href="#Use-case" class="headerlink" title="Use case"></a>Use case</h5><p>－ Empty data in <code>UITableView／UICollectionView</code><br>－ No network connection<br>－ Network connection failure<br>－ Loading data</p>
<h5 id="What-does-it-look-like-before"><a href="#What-does-it-look-like-before" class="headerlink" title="What does it look like before?"></a>What does it look like before?</h5><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// BaseViewController.h</span></div><div class="line">- (<span class="keyword">void</span>)showBlankViewWithString:(<span class="built_in">NSString</span> *)attention forView:(<span class="built_in">UIView</span> *)view;</div><div class="line">- (<span class="keyword">void</span>)hideBlankView;</div><div class="line"></div><div class="line"><span class="comment">// BaseViewController.m</span></div><div class="line"><span class="meta">#pragma mark - Blank</span></div><div class="line">- (<span class="keyword">void</span>)showBlankViewWithString:(<span class="built_in">NSString</span> *)attention forView:(<span class="built_in">UIView</span> *)view</div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> (!_blankView) &#123;</div><div class="line">        <span class="built_in">CGFloat</span> x = view.frame.origin.x;</div><div class="line">        <span class="built_in">CGFloat</span> width = view.frame.size.width;</div><div class="line">        <span class="built_in">CGFloat</span> height = view.frame.size.height;</div><div class="line">        _blankView = [[<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>( x + (width - <span class="number">175</span>)/<span class="number">2.</span>f, height/<span class="number">3.</span>f, <span class="number">175</span>, <span class="number">200</span>)];</div><div class="line">        _blankView.backgroundColor = [<span class="built_in">UIColor</span> clearColor];</div><div class="line"><span class="comment">//        [self.view insertSubview:_blankView aboveSubview:view];</span></div><div class="line">        [<span class="keyword">self</span>.view addSubview:_blankView];</div><div class="line"></div><div class="line">        <span class="built_in">UIImageView</span> *blankImgView = [[<span class="built_in">UIImageView</span> alloc] initWithImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"blank_content"</span>]];</div><div class="line">        blankImgView.frame = <span class="built_in">CGRectMake</span>(<span class="number">25</span>, <span class="number">0</span>, <span class="number">125</span>, <span class="number">150</span>);</div><div class="line">        [_blankView addSubview:blankImgView];</div><div class="line"></div><div class="line">        _attentionLabel = [[<span class="built_in">UILabel</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="built_in">CGRectGetMaxY</span>(blankImgView.frame) + kTVCVCellInset_X, <span class="number">175</span>, kMediumFontSize + <span class="number">2</span>)];</div><div class="line">        _attentionLabel.numberOfLines = <span class="number">0</span>;</div><div class="line">        _attentionLabel.textAlignment = <span class="built_in">NSTextAlignmentCenter</span>;</div><div class="line">        _attentionLabel.textColor = kLightGrayColor;</div><div class="line">        _attentionLabel.font = [<span class="built_in">UIFont</span> systemFontOfSize:kMediumFontSize];</div><div class="line">        [_blankView addSubview:_attentionLabel];</div><div class="line">    &#125;</div><div class="line">    [<span class="keyword">self</span>.view bringSubviewToFront:_blankView];</div><div class="line">    _attentionLabel.text = attention;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)hideBlankView</div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> (_blankView != <span class="literal">nil</span>) &#123;</div><div class="line">        [_blankView removeFromSuperview];</div><div class="line">        _blankView  = <span class="literal">nil</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>And call these methods anywhere and choose the right <em>view</em> like this:<br><figure class="highlight pf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[<span class="literal">self</span> showBlankViewWithString:kNetworkFailureKey <span class="keyword">for</span>View:<span class="literal">self</span>.view];</div></pre></td></tr></table></figure></p>
<p>or write <em>if-else</em> everywhere like this:<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">	<span class="keyword">if</span> (tmpArray.count &lt;= <span class="number">0</span>) &#123;</div><div class="line">    <span class="keyword">self</span>.tableView.hidden = <span class="literal">YES</span>;</div><div class="line">    [<span class="keyword">self</span> showBlankViewWithString:<span class="string">@"No Data"</span> forView:<span class="keyword">self</span>.view];</div><div class="line">&#125;</div><div class="line"><span class="keyword">else</span>&#123;</div><div class="line">    [<span class="keyword">self</span> hideBlankView];</div><div class="line">    <span class="keyword">self</span>.tableView.hidden = <span class="literal">NO</span>;</div><div class="line">	......</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h5 id="What-does-it-look-like-now"><a href="#What-does-it-look-like-now" class="headerlink" title="What does it look like now?"></a>What does it look like now?</h5><p>Get your data as usual and just call:<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="section">[self reloadListData:EmptyType_EmptyData]</span><span class="comment">;</span></div></pre></td></tr></table></figure></p>
<p>or<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="section">[self reloadListData:EmptyType_NetworkError]</span><span class="comment">;</span></div></pre></td></tr></table></figure></p>
<p>or<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="section">[self reloadListData:EmptyType_NoNetwork]</span><span class="comment">;</span></div></pre></td></tr></table></figure></p>
<p>And all the annoying issues is done!</p>
<p>The only thing you need to do is inheriting from<code>BaseEmptyViewController</code> and set <code>needsEmptyDataHandling</code> to be <code>YES</code>.<br><figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// YourViewController.h</span></div><div class="line"><span class="variable">@interface</span> <span class="attribute">YourViewController </span>: BaseEmptyViewController</div><div class="line"><span class="variable">@end</span></div><div class="line"></div><div class="line"><span class="comment">// YourViewController.m</span></div><div class="line">	self.needsEmptyDataHandling = YES;</div></pre></td></tr></table></figure></p>
<p>For more details, please check <a href="https://github.com/CaliosD/CDEmptyDataSet" target="_blank" rel="external">this</a>.</p>
<h5 id="References"><a href="#References" class="headerlink" title="References"></a>References</h5><p>－ <a href="http://blog.yangmeyer.de/ios-dev/2013/05/11/best-practice-handling-empty-table-views.html" target="_blank" rel="external">http://blog.yangmeyer.de/ios-dev/2013/05/11/best-practice-handling-empty-table-views.html</a><br>－ <a href="https://github.com/dzenbot/DZNEmptyDataSet" target="_blank" rel="external">https://github.com/dzenbot/DZNEmptyDataSet</a><br>－ <a href="http://stackoverflow.com/questions/7547934/animated-reloaddata-on-uitableview" target="_blank" rel="external">http://stackoverflow.com/questions/7547934/animated-reloaddata-on-uitableview</a></p>

        </div></article>
      <article class="post">
    <header class="post-header">
      <h1 class="post-title"><a class="post-link" href="/2016/05/04/notes-in-table-view-programming-guide-for-iOS/">Some notes in `Table View Programming Guide for iOS`</a>
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2016-05-04
        </span></div>
    </header>

    <div class="post-content"><blockquote>
<p>If you want to change the background color of a cell, do so in the <code>tableView:willDisplayCell:forRowAtIndexPath:</code> method of your table view delegate.</p>
<p>The table view’s data source implementation of <code>tableView:cellForRowAtIndexPath:</code> should always reset all content when reusing a cell.</p>
<p><code>indentationLevel</code> property for UITableViewCell</p>
</blockquote>

        </div></article>
      <article class="post">
    <header class="post-header">
      <h1 class="post-title"><a class="post-link" href="/2016/04/26/dynamically-adding-class-methods-with-runtime/">Dynamically adding class methods with runtime</a>
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2016-04-26
        </span></div>
    </header>

    <div class="post-content"><p>Today I learned how to add dynamic instance methods in class like this.<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">+ (<span class="built_in">BOOL</span>)resolveInstanceMethod:(SEL)sel</div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> ([<span class="built_in">NSStringFromSelector</span>(sel) isEqualToString:<span class="string">@"sing"</span>]) &#123;</div><div class="line">        class_addMethod(<span class="keyword">self</span>, sel, (IMP)otherSing, <span class="string">"v@:"</span>);</div><div class="line">        <span class="keyword">return</span> <span class="literal">YES</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> [<span class="keyword">super</span> resolveInstanceMethod:sel];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> otherSing(<span class="keyword">id</span> <span class="keyword">self</span>, SEL cmd)</div><div class="line">&#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@ is singing."</span>,((People *)<span class="keyword">self</span>).name);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>When I was typing the code myself, I found another similar method: <code>resolveClassMethod:</code>. Maybe I could use it the same way, I thought. So, here’s the first version.<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">+ (<span class="built_in">BOOL</span>)resolveClassMethod:(SEL)sel</div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> ([<span class="built_in">NSStringFromSelector</span>(sel) isEqualToString:<span class="string">@"dance"</span>]) &#123;</div><div class="line">        class_addMethod(<span class="keyword">self</span>, sel, (IMP)otherDance, <span class="string">"v@:"</span>);</div><div class="line">        <span class="keyword">return</span> <span class="literal">YES</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> [<span class="keyword">super</span> resolveClassMethod:sel];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> otherDance(<span class="keyword">id</span> <span class="keyword">self</span>, SEL cmd)</div><div class="line">&#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"Dancing! Let's rock!"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Build and run.</p>
<p>Boom! It crashed sadly, and an unrecognized selector error at runtime was throwed out.</p>
<p>Why?</p>
<p>Digging like a gopher in the Internet(:P), I found Jeff explained <a href="http://iphonedevelopment.blogspot.jp/2008/08/dynamically-adding-class-objects.html" target="_blank" rel="external">here</a> in detail:</p>
<blockquote>
<p>Because that code adds a method to the class object, which means you added an instance method to that class. That’s not what you want. What you want is to add a method to your class’ metaclass object instance, which means going to the runtime to get the Class object that represents the class’ metaclass object (say that five times fast!).</p>
</blockquote>
<p>So, replace the code above with below would work well.<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">+ (<span class="built_in">BOOL</span>)resolveClassMethod:(SEL)sel</div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> ([<span class="built_in">NSStringFromSelector</span>(sel) isEqualToString:<span class="string">@"dance"</span>]) &#123;</div><div class="line">        Class selfMetaClass = objc_getMetaClass([[<span class="keyword">self</span> className] UTF8String]);</div><div class="line">        class_addMethod(selfMetaClass, sel, (IMP)otherDance, <span class="string">"v@:"</span>);</div><div class="line">        <span class="keyword">return</span> <span class="literal">YES</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> [<span class="keyword">super</span> resolveClassMethod:sel];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> otherDance(<span class="keyword">id</span> <span class="keyword">self</span>, SEL cmd)</div><div class="line">&#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"Dancing! Let's rock!"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Now, people could rock as they wished. :P</p>
<p>Wait, what hell was the …  “”v@:”” ?? Seemed odd.</p>
<p>Well, let’s have another digging(:P).</p>
<p>Here it is:</p>
<table>
<thead>
<tr>
<th>type</th>
<th>meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td>i/v</td>
<td>return int/void  </td>
</tr>
<tr>
<td>@</td>
<td>parameter id(self)</td>
</tr>
<tr>
<td>:</td>
<td>SEL(_cmd)</td>
</tr>
<tr>
<td>@</td>
<td>id(str)</td>
</tr>
</tbody>
</table>
<p>More detail encodings are <a href="https://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/ObjCRuntimeGuide/Articles/ocrtTypeEncodings.html" target="_blank" rel="external">here</a>.</p>
<p>OK. That’s finally done. See you another topic. :]</p>

        </div></article>
      <article class="post">
    <header class="post-header">
      <h1 class="post-title"><a class="post-link" href="/2016/04/20/how-to-disable-the-UITableView-UICollectionView-selection-highlighting/">How to disable the UITableView-UICollectionView selection highlighting</a>
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2016-04-20
        </span></div>
    </header>

    <div class="post-content"><p>Here’s a summary for the UITableView issue <a href="http://stackoverflow.com/a/6305493/1594792" target="_blank" rel="external">here</a> and I added UICollectionView part below in union.</p>
<hr>
<p>Depending on your desired logic and/or result, you’ve got nearly 5 different ways to solve it:</p>
<p>1.To disable the blue highlighting <strong>without changing any other interaction of the (UITableView) cell</strong>:<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="section">[cell setSelectionStyle:UITableViewCellSelectionStyleNone]</span><span class="comment">;</span></div></pre></td></tr></table></figure></p>
<p><strong>PS:</strong></p>
<p>There’re two points here to mention:</p>
<ul>
<li>The <code>tableView:didSelectRowAtIndexPath:</code> delegate is not prevented and you can workaround with “if” statements.</li>
<li>Since UICollectionView has no <code>selectionStyle:</code> property, you have to handle it with the second way below.</li>
</ul>
<p>2.Disable highlighting of UITableView/UICollectionView <strong>without changing any other interaction of the (UITableView) cell</strong><br><figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="section">[tableView setAllowsSelection:NO]</span><span class="comment">;</span></div></pre></td></tr></table></figure></p>
<p>or<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="section">[collectionView setAllowsSelection:NO]</span><span class="comment">;</span></div></pre></td></tr></table></figure></p>
<p>3.To make a cell “read-only”, you can simply do this:<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="section">[cell setUserInteractionEnabled:NO]</span><span class="comment">;</span></div></pre></td></tr></table></figure></p>
<p>4.To make an entire table “read-only”:<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="section">[tableView setUserInteractionEnabled:NO]</span><span class="comment">;</span></div></pre></td></tr></table></figure></p>
<p><strong>Attention:</strong></p>
<p>This way will forbid UITableView scroll normally as a scrollview. So, be careful about it.</p>
<p>5.To determine on-the-fly whether to highlight a cell (which according to this answer implicitly includes selection), you can implement the following <code>UITableViewDelegate</code> protocol method:<br><figure class="highlight erlang"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">- <span class="params">(BOOL)</span>tableView:<span class="params">(UITableView *)</span>tableView</div><div class="line">   shouldHighlightRowAtIndexPath:<span class="params">(NSIndexPath *)</span>indexPath</div></pre></td></tr></table></figure></p>
<p>More info from <a href="https://developer.apple.com/library/ios/documentation/UIKit/Reference/UITableViewDelegate_Protocol/index.html#//apple_ref/doc/uid/TP40006942-CH3-SW32" target="_blank" rel="external">iOS Developer Library</a>:</p>
<blockquote>
<p>As touch events arrive, the table view highlights rows in anticipation of the user selecting them. As it processes those touch events, the table view calls this method to ask your delegate if a given cell should be highlighted. Your delegate can implement this method and use it to prevent the highlighting of a row when another row is already selected or when other relevant criteria occur.<br>If you do not implement this method, the default return value is YES.</p>
</blockquote>

        </div></article>
      <article class="post">
    <header class="post-header">
      <h1 class="post-title"><a class="post-link" href="/2016/04/20/pitfall-2/">Cell的highlight</a>
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2016-04-20
        </span></div>
    </header>

    <div class="post-content"><p>最近踩到一个坑，表现状况如下：</p>
<p>UICollectionView的Cell中有一个UIImageView，有选中和未选中两个状态。在某种条件下点击时是不做任何改变的（即保持未选中状态）。</p>
<p>起初的做法是：<br>将UIImageView的<code>image</code>／<code>hightedImage</code>属性和cell的选中／未选中状态进行绑定，通过UIImageView的<code>setHighlighted:</code>方法来切换选中状态。</p>
<pre><code>// MyController.m
- (void)collectionView:(UICollectionView *)collectionView didSelectItemAtIndexPath:(NSIndexPath *)indexPath
{
    if (conditionAIsSatisfied) {
        ......
    }
}

// MyCollectionViewCell.m
- (void)updateCellWithSelected:(BOOL)selected
{
    [_imgView setHighlighted:selected];
}
</code></pre><p>存在的问题是：<br>在UICollectionView的<code>didSelectItemAtIndexPath:</code>方法中，即使不执行if语句中的更新imageView的方法，<code>_imgView</code>也会更新为选中状态的图片。而collectionViewCell中的<code>updateCellWithSelected:</code>也是没有执行的。那么，为什么<code>_imgView</code>的图片会更新呢？<br>类似的，在UITableView中做同样的控制，UITableViewCell中<code>_imgView</code>的图片为什么就不会改变呢？</p>
<p><code>UICollectionViewDelegate</code>中相关的各个回调方法如下。</p>
<blockquote>
<p>// Methods for notification of selection/deselection and highlight/unhighlight events.<br>// The sequence of calls leading to selection from a user touch is:<br>//<br>// (when the touch begins)<br>// 1. -collectionView:shouldHighlightItemAtIndexPath:<br>// 2. -collectionView:didHighlightItemAtIndexPath:<br>//<br>// (when the touch lifts)<br>// 3. -collectionView:shouldSelectItemAtIndexPath: or -collectionView:shouldDeselectItemAtIndexPath:<br>// 4. -collectionView:didSelectItemAtIndexPath: or -collectionView:didDeselectItemAtIndexPath:<br>// 5. -collectionView:didUnhighlightItemAtIndexPath:</p>
</blockquote>
<p>UICollectionViewCell并没有像UITableViewCell一样提供类似<code>selectionStyle</code>的属性来直接将选中时的样式设置为<code>UITableViewCellSelectionStyleNone</code>，而是给了开发者更多的灵活性，提供了更多的代理方法。通过查看<code>UICollectionViewDelegate</code>以及在<code>shouldSelectItemAtIndexPath:</code>和<code>didHighlightItemAtIndexPath:</code>等函数中打断点逐个排查，发现cell的highlighted和imageview的highlighted是关联的。当cell被选中时，虽然<code>didSelectItemAtIndexPath:</code>方法并没有执行实质性的代码，但在其之前执行的<code>shouldHighlightItemAtIndexPath:</code>方法默认为<code>YES</code>，使整个cell的状态为highlighted，相应的imageView的状态就是显示highlighted的图片了。</p>
<p>知道了原因之后，总结了两个解决方案：</p>
<p>1.添加<code>shouldSelectItemAtIndexPath:</code>方法，在其中增加<code>conditionAIsSatisfied</code>的判断，来对应地返回<code>YES</code>或<code>NO</code>。<br>2.在<code>MyCollectionViewCell</code>中，不再为UIImageView的<code>image</code>／<code>hightedImage</code>设置不同的图片，而是设置为同一个图片。然后在<code>-updateCellWithSelected:</code>中根据<code>selected</code>值来替换选中／未选中的图片。</p>
<p>对比来看，1的缺点在于，已选中的cell无法取消选中。2的缺点在于，切换图片时会有点突兀。</p>
<p>综合考量，我最后选择了方案2。</p>
<hr>
<p><strong>Update 0420</strong></p>
<p>但是，上面啰嗦了半天，其实只需要一句代码解决问题：</p>
<pre><code>collectionView.allowSelection = NO;
</code></pre><p>来自<a href="http://stackoverflow.com/a/6305493/1594792" title="http://stackoverflow.com/a/6305493/1594792" target="_blank" rel="external">这里</a>。UITableView同理。</p>
<p>果然是简洁至上。</p>

        </div></article>
      <article class="post">
    <header class="post-header">
      <h1 class="post-title"><a class="post-link" href="/2016/04/20/bash-commands-in-some-useful-cases/">Bash commands in some useful cases</a>
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2016-04-20
        </span></div>
    </header>

    <div class="post-content"><p>1.Rename files in batch<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span><span class="bash"> <span class="keyword">for</span> i <span class="keyword">in</span> *.m; <span class="keyword">do</span> mv <span class="string">"<span class="variable">$i</span>"</span> <span class="string">"Qn<span class="variable">$i</span>"</span>; <span class="keyword">done</span></span></div></pre></td></tr></table></figure></p>
<p>2.Compress images in batch<br><figure class="highlight sqf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ <span class="built_in">find</span> ./ -<span class="built_in">name</span> <span class="string">'*.jpg'</span> -<span class="built_in">exec</span> convert -<span class="built_in">resize</span> <span class="number">80</span>%x80% &#123;&#125; &#123;&#125; \;</div></pre></td></tr></table></figure></p>
<p>3.Refresh launchpad (I used it when failed to find icons in it.)<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ rm ~<span class="regexp">/Library/</span>Application\ Support<span class="regexp">/Dock/</span>*.db; killall Dock</div></pre></td></tr></table></figure></p>
<p>4.A tip of showing download things in App Store<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span><span class="bash"> lsof | grep -i pkg</span></div></pre></td></tr></table></figure></p>

        </div></article>
      <article class="post">
    <header class="post-header">
      <h1 class="post-title"><a class="post-link" href="/2016/03/30/UIImagePickerController-breaks-status-bar-appearance/">UIImagePickerController breaks status bar appearance</a>
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2016-03-30
        </span></div>
    </header>

    <div class="post-content"><p>As Rich86man mentioned <a href="http://stackoverflow.com/a/18883563/1594792" target="_blank" rel="external">here</a>, the following is a possible solution.</p>
<blockquote>
<p>In the view controller who calls the image picker, set yourself as the delegate of the image Picker. (You’re probably already doing this)<br>     UIImagePickerController* imagePicker = [[UIImagePickerController alloc] init];<br>     imagePicker.delegate = self;</p>
<p>Since UIImagePickerController is a type of Navigation controller, you’re also setting yourself as the UINavigationController delegate. Then :<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;</span><span class="bash"> 	- (void)navigationController:(UINavigationController *)navigationController willShowViewController:(UIViewController *)viewController animated:(BOOL)animated</span></div><div class="line"><span class="meta">&gt;</span><span class="bash"> 	&#123;</span></div><div class="line"><span class="meta">&gt;</span><span class="bash"> 	      [[UIApplication sharedApplication] setStatusBarStyle:UIStatusBarStyleLightContent];</span></div><div class="line"><span class="meta">&gt;</span><span class="bash"> 	&#125;</span></div></pre></td></tr></table></figure></p>
<p>Replace UIStatusBarStyleLightContent with whatever style you are looking for.</p>
</blockquote>
<p>However, in my case, I found it would be fine just adding a line of code(only add as you need) in <code>- viewWillAppear:</code> function.<br><figure class="highlight scheme"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[[<span class="name">UIApplication</span> sharedApplication] setStatusBarHidden:NO]<span class="comment">;</span></div><div class="line">[[<span class="name">UIApplication</span> sharedApplication] setStatusBarStyle:UIStatusBarStyleLightContent animated:YES]<span class="comment">;</span></div></pre></td></tr></table></figure></p>
<p>Each time UIImagePickerController dismissed, <code>- viewWillAppear:</code> would be called and set status bar right.</p>

        </div></article>
      <nav class="pagination"><a class="prev" href="/page/4/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text">Prev</span>
      </a>
    <a class="next" href="/page/6/">
        <span class="next-text">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    </nav></section></div></div>
      </main>

      <footer id="footer" class="footer"><div class="social-links"><a href="mailto:calios_1124@163.com" class="iconfont icon-email" title="email"></a>
        <a href="http://github.com/caliosd" class="iconfont icon-github" title="github"></a>
        <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
    </div><div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://hexo.io/">Hexo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/ahonn/hexo-theme-even">Even</a>
  </span>

  <span class="copyright-year">&copy;2015 - 2020<span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Calios</span>
  </span>
</div>
</footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div><script type="text/javascript" src="/lib/jquery/jquery.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/src/even.js?v=2.11.0"></script>
</body>
</html>
