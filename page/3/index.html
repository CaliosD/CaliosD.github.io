<!DOCTYPE html>
<html lang="en">
  <head><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="description" content="Stedfast as thou art."/><link rel="alternate" href="/atom.xml" title="Calios' Eden"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.11.0" />
<link rel="canonical" href="http://www.caliosd.gq/page/3/"/>

<link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css" />
<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.11.0" />

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-71292392-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-71292392-1');
</script><script id="baidu_push">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<script>
  window.config = {"leancloud":{"app_id":null,"app_key":null},"toc":true,"fancybox":true,"pjax":"","latex":false};
</script>

    <title>Calios' Eden</title>
  <link rel="alternate" href="/atom.xml" title="Calios' Eden" type="application/atom+xml">
</head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">Calios' Eden</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list"><a href="/">
        <li class="mobile-menu-item">Home
          </li>
      </a><a href="/archives/">
        <li class="mobile-menu-item">Archives
          </li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags
          </li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About
          </li>
      </a></ul>
</nav>
<div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">Calios' Eden</a>
</div>

<nav class="site-navbar"><ul id="menu" class="menu"><li class="menu-item">
          <a class="menu-item-link" href="/">
            Home
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            Archives
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/tags/">
            Tags
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/about/">
            About
            </a>
        </li>
      </ul></nav>
</header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content"><section id="posts" class="posts"><article class="post">
    <header class="post-header">
      <h1 class="post-title"><a class="post-link" href="/2017/02/17/summary-for-Objective-C-foundation-book/">Objective-C基础教程（第2版）总结</a>
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2017-02-17
        </span></div>
    </header>

    <div class="post-content"><p>— <strong>Updated: 170729</strong> —</p>
<p>软件设计的准则：（SOLID）</p>
<ul>
<li>单一职责：Single responsibility</li>
<li>开放封闭：Open-closed</li>
<li>里氏代换：Liskov substitution</li>
<li>接口分离：Interface segregation</li>
<li>依赖倒置：Dependency inversion</li>
</ul>
<p>设计模式是内功心法，而所谓23种只是表现形式罢了。</p>
<hr>
<ul>
<li>OOP真正的革命性就是它在调用代码中使用间接（indirect），如使用变量、文件和参数等。“没有什么是通过间接解决不了的问题，如果有，就再加一层。”<blockquote>
<p>比如黑魔法第二课中提到的<code>#define _CONCAT(A,B)  A ## B</code>的作用。再比如，键值编码（KVC）也是一种间接更改对象状态的方式。</p>
</blockquote>
</li>
<li>过程式编程以函数为中心，面向对象编程以数据为中心。</li>
<li>类是一种结构，它表示对象的类型；对象是一种结构，它包含值和指向其类的隐藏指针。</li>
<li>在Objective-C中只要看到@符号，你都可以把它看成是C语言的扩展。如：NSLog(@“this is a log: %@“, log);</li>
<li>对象是带有代码的C struct。因此，id实际上是一个指针，指向其中的某个结构。</li>
<li>@interface告诉编译器这个类的对象的数据成员（即对象的C struct应该是什么样子）和它提供的特性。</li>
<li>Objective-C的中缀符（infix notation）。</li>
<li>Objective-C中并没有真正意义上的私有方法，也无法通过标记为私有方法而禁止其他代码调用它。这是Objective-C动态本质的副作用。</li>
</ul>
<blockquote>
<p>这里可以和runtime联系起来。因为即便在编译器编译后，代码也可以在运行时改变类所拥有的属性、或是改变方法调用的实现。这给开发者提供了很多便利，也不可避免地带来一些副作用（side effect）。</p>
</blockquote>
<ul>
<li>在Objective-C中每个方法调用都获得了一个名为self的隐藏参数，它是一个指向接收消息的对象的指针。方法使用self参数查找它们要使用的实例变量。eg: self-&gt;fillColor = c;</li>
<li>由于对象的局部变量特定于该对象的实例，因此称为实例变量，通常简写为ivars。</li>
<li>Objective-C有个极好的特性，你可以把类当做对象来向类发送消息。</li>
</ul>
<blockquote>
<p><del>这个“极好的特性”，是相对于谁来说的？C？其他语言？？</del><br>应该是指可以有类方法，而不仅是实例方法。</p>
</blockquote>
<ul>
<li>多态使得来自不同类的对象可以定义共享相同名称的方法。动态类型能使程序直到执行时才确定对象所属的类。动态绑定则能使程序直到执行时才确定要对对象调用的实际方法。而id类型是这三者的基础。</li>
<li>防御式编程。</li>
<li>Cocoa的方法名称如果以get开头，表明我们提供的是一个指针，而指针所指向的空间则是用来存储该方法生成的数据。如<code>NSValue</code>的<code>getValue:</code>方法。</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSValue</span> *value = [<span class="built_in">NSValue</span> valueWithBytes:&amp;rect objCType:<span class="keyword">@encode</span>(<span class="built_in">CGRect</span>)];</div><div class="line"><span class="built_in">NSMutableArray</span> *arr = [<span class="built_in">NSMutableArray</span> array];</div><div class="line">[arr addObject:value];</div><div class="line"></div><div class="line"><span class="built_in">NSValue</span> *v = arr[<span class="number">0</span>];</div><div class="line">[v getValue:&amp;rect];</div></pre></td></tr></table></figure>
<ul>
<li><code>#import</code>时，带尖括号的语句是用来导入系统头文件的，是只读的；而带引号的语句说明导入的是项目本地的头文件，是可编辑的。</li>
<li>self：<ul>
<li><code>self</code> is a special variable in Objective-C, inside an instance method this variable refers to the receiver(object) of the message that invoked the method, while in a class method <code>self</code> will indicate which class is calling.</li>
<li><code>self</code> refers to the actual object that is executing the current method, it is an invisible argument passed automatically by the runtime environment to your instance methods.</li>
</ul>
</li>
<li>对象的初始化过程：来自NSObject的类方法alloc，为该类（对象？）分配一块足够大的内存，以存放该类的全部实例变量，并将其清零；实例方法init用于获得一个对象并使其运行。</li>
<li>为什么要写成：<code>Car *car = [[Car alloc] init]; 而不是 Car *car = [Car alloc]; [car init];</code>? （关键词：类簇）<ul>
<li>因为初始化方法返回的对象可能与分配的对象不同。如NSNumber、NSString和NSArray这样的类簇的情况。</li>
<li>由于init方法可以接受参数，所以该方法的代码能够检查其接受的参数，并断定返回另一个类的对象可能更合适。</li>
<li>Xcode会检查是否alloc与init是嵌套的，如果不是会给出提示。<code>*** Terminating app due to uncaught exception &#39;NSInvalidArgumentException&#39;, reason: &#39;*** -objCType only defined for abstract class.  Define -[NSPlaceholderNumber objCType]!’</code></li>
</ul>
</li>
</ul>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">NSNumber *<span class="keyword">boo </span>= [[NSNumber alloc] initWithBool:NO]<span class="comment">;</span></div><div class="line">NSNumber *<span class="keyword">boo1 </span>= [NSNumber alloc]<span class="comment">;</span></div><div class="line">NSNumber *<span class="keyword">boo2 </span>= [<span class="keyword">boo1 </span>initWithBool:NO]<span class="comment">;</span></div><div class="line">NSLog(@<span class="string">"boo: %@ \n boo1: %@ \n boo2: %@"</span>,[<span class="keyword">boo </span>class],[<span class="keyword">boo1 </span>class],[<span class="keyword">boo2 </span>class])<span class="comment">;</span></div></pre></td></tr></table></figure>
<p>这段代码打印的的结果是：<br><figure class="highlight armasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">boo: </span>__NSCFBoolean</div><div class="line"><span class="keyword">boo1: </span>NSPlaceholderNumber</div><div class="line"><span class="keyword">boo2: </span>__NSCFBoolean</div></pre></td></tr></table></figure></p>
<p>可见，仅仅分配内存的对象boo1和初始化方法返回的boo2并不相同。</p>
<ul>
<li>通常，接受参数最多的初始化方法最终成为 <strong>指定初始化函数</strong>。</li>
<li>预编译指令<code>@property</code>可以通知编译器：“这个对象具有这个类型的这个名称的这种属性”，还可以传递一些关于property（如<code>readonly</code>和<code>readwrite</code>）和对象的内存管理（<code>retain</code>，<code>assign</code>或<code>copy</code>）的信息；<code>@synthesize</code>预编译指令可以通知编译器生成访问器方法。</li>
<li>有的属性列表文件，特别是首选项文件，是以压缩的二进制格式存储的。通过使用plutil命令：<code>plutil -convert xml1 文件名.plist</code>，可以将这些文件转换成人可以理解的字面形式。</li>
<li>对于KVC，Cocoa会自动装箱和开箱标量值。也就是说，当使用 <code>setValueForKey</code>时，它自动将标量值（int、float和struct）放入<code>NSNumber</code>或<code>NSValue</code>中；当使用<code>-setValueForKey:</code>时，它自动将标量值从这些对象中取出。仅KVC具有这种自动装箱功能，常规方法调用和属性语法不具备该功能。</li>
<li><p><code>valueForKey:</code>在Objective-C运行时中使用元数据打开对象并进入其中查找需要的信息。在C或C++语言中不能执行这种操作。通过使用KVC，没有相关getter方法也能获取对象值，不需要通过对象指针来直接访问实例变量。</p>
<blockquote>
<p>这里体现的就是Objective-C“自省”的特性吧？</p>
</blockquote>
</li>
<li><p>（在console的打印结果中）注意<null>与(null)之间的区别。<null>是一种<code>[NSNull null]</code>对象，而(null)是一个真正的<code>nil</code>值。</null></null></p>
</li>
<li><code>NSPredicate</code>字符串中也可以用<code>%K</code>来指定键路径。如<code>predicate = [NSPredicate predicateWithFormat: @&quot;%K beginswith %@&quot;, @&quot;name&quot;, @&quot;B&quot;];</code>。</li>
<li>谓词机制不进行静类型检查。</li>
<li>在编写谓词字符串时，尽量使用[cd]修饰符。其中，c表示“不区分大小写（case insensitive）”，d表示“不区分发音符号（diacritic insensitive）”，[cd]表示“既不区分大小写，也不区分发音符号”。如：<code>predicate = [NSPredicate predicateWithFormat: @&quot;name BEGINSWITH[cd] &#39;HERB&#39;&quot;];</code>。</li>
</ul>

        </div></article>
      <article class="post">
    <header class="post-header">
      <h1 class="post-title"><a class="post-link" href="/2017/02/09/essay-travel-and-Objective-C-170209/">0209-旅行与Objective-C</a>
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2017-02-09
        </span></div>
    </header>

    <div class="post-content"><p>我居然在24小时之内将自己蠢蠢欲动极其想去旅行的心平抚了下来。也是有点小佩服自己。</p>
<p>我想，旅行可以带给我的，是一个未知的世界。我为之欣喜并享受其中的，正是对未知的探索。</p>
<p>而同样，这两天来，在潜意识中，黑魔法的课程也在引导我一步步去回归当初学习Objective-C的初心，重新审视这门被我用了近五年、却依旧深感知之甚少的语言。</p>
<p>这样看来，旅行于我，是平面上扩展视野的疆土，是滋养心尖的养分；而Objective-C于我，是立体上挖掘一门语言的美感，是构建知识树的根基。二者在某种程度上，带给我的是类似的体验。这或许正是居然能够用后者来抚慰前者的原因吧。</p>

        </div></article>
      <article class="post">
    <header class="post-header">
      <h1 class="post-title"><a class="post-link" href="/2017/01/11/barriers-when-using-TesseractOCR/">Some barriers when using TesseractOCR</a>
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2017-01-11
        </span></div>
    </header>

    <div class="post-content"><p>1.Install TesseractOCR with CocoaPods.</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">pod</span> <span class="string">'TesseractOCRiOS'</span>, <span class="string">'4.0.0'</span></div></pre></td></tr></table></figure>
<p>2.Download tessdata, generally from Github:<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ wget https:<span class="regexp">//gi</span>thub.com<span class="regexp">/tesseract-ocr/</span>tessdata<span class="regexp">/raw/m</span>aster<span class="regexp">/eng.traineddata</span></div></pre></td></tr></table></figure></p>
<p>Then move them to the <code>/usr/local/share/tessdata</code> folder.<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span><span class="bash"> sudo mv -v eng.traineddata /usr/<span class="built_in">local</span>/share/tessdata/</span></div></pre></td></tr></table></figure></p>
<p>However, it crashed saying:</p>
<blockquote>
<p>actual_tessdata_num_entries \&lt;= TESSDATA_NUM_ENTRIES:Error:Assert failed:in file ..\ccutil\tessdatamanager.cpp, line 55</p>
</blockquote>
<p>and would never work with the FAQ <a href="https://github.com/tesseract-ocr/tesseract/wiki/FAQ#actual_tessdata_num_entries_-tessdata_num_entrieserrorassert-failedin-file-ccutiltessdatamanagercpp-line-55_" target="_blank" rel="external">here</a> by checking out the right version(for me, it’s 4.0.0) of trained data.</p>
<p>Finally, the issue <a href="https://github.com/gali8/Tesseract-OCR-iOS/issues/299" target="_blank" rel="external">here</a> solved this creepy problem by checking out <a href="https://github.com/tesseract-ocr/tessdata/tree/bf82613055ebc6e63d9e3b438a5c234bfd638c93" target="_blank" rel="external">this version</a> of trained data. This is just such a… boring problem…</p>
<p>Here’s a little sample for how to use it, and, enjoy yourself. :]<br><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">G8Tesseract *tesseract = [[G8Tesseract alloc] initWithLanguage:@<span class="string">"eng"</span>]<span class="comment">;</span></div><div class="line">                                       tesseract.delegate = weakSelf<span class="comment">;</span></div><div class="line">                                       tesseract.charWhitelist = @<span class="string">"@.()&#123;&#125;/\\!*&amp;#0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"</span><span class="comment">;</span></div><div class="line">                                       tesseract.engineMode = G8OCREngineModeTesseractOnly<span class="comment">;</span></div><div class="line">                                       tesseract.pageSegmentationMode = G8PageSegmentationModeAuto<span class="comment">;</span></div><div class="line">                                       tesseract.image = [image g8_blackAndWhite]<span class="comment">;</span></div><div class="line">                                       tesseract.maximumRecognitionTime = <span class="number">2</span>.<span class="number">0</span><span class="comment">;</span></div><div class="line">                                       [tesseract recognize]<span class="comment">;</span></div><div class="line"></div><div class="line">                                       <span class="keyword">dispatch_async(dispatch_get_main_queue(), </span>^&#123;</div><div class="line">                                           weakSelf.codeTextView<span class="meta">.text</span> = [[tesseract recognizedText] stringByTrimmingCharactersInSet:[NSCharacterSet whitespaceAndNewlineCharacterSet]]<span class="comment">;</span></div><div class="line">                                           weakSelf.codeImageView.image = image<span class="comment">;</span></div><div class="line">                                       &#125;)<span class="comment">;</span></div></pre></td></tr></table></figure></p>
<p><strong>Updated at 170119</strong></p>
<p>When compiled with terminal, bitcode should be disabled in podfile.</p>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">post_install <span class="built_in">do</span> |<span class="type">installer</span>|</div><div class="line">    <span class="type">installer</span>.pods_project.targets.each <span class="built_in">do</span> |<span class="type">target</span>|</div><div class="line">        <span class="type">target</span>.build_configurations.each <span class="built_in">do</span> |<span class="type">config</span>|</div><div class="line">            <span class="type">config</span>.build_settings['ENABLE_BITCODE'] = 'false'</div><div class="line">        <span class="keyword">end</span></div><div class="line">    <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<hr>
<p><strong>Ref:</strong></p>
<ul>
<li><a href="https://www.raywenderlich.com/93276/implementing-tesseract-ocr-ios" target="_blank" rel="external">https://www.raywenderlich.com/93276/implementing-tesseract-ocr-ios</a></li>
</ul>

        </div></article>
      <article class="post">
    <header class="post-header">
      <h1 class="post-title"><a class="post-link" href="/2017/01/10/download-manager/">Some methods for DownloadManager</a>
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2017-01-10
        </span></div>
    </header>

    <div class="post-content"><p>随着苹果提供API的不断完善，实现下载管理的方法也发生了一些变化。从使用更方便的第三方库，到完全可以用自带API实现毫无压力。且将各种方法记录于此，权当备查。</p>
<p>首先定义一下下载管理的范围：</p>
<ul>
<li>可以同时下载多个文件；</li>
<li>对于单个文件而已，可以下载/暂定/恢复下载/取消下载/显示下载进度；</li>
<li>可以控制同时下载的最大数量。</li>
</ul>
<p>接下来，从最早采用的实现方法说起。</p>
<ol>
<li>NSOperationQueue</li>
</ol>
<ul>
<li>创建继承自<code>NSOperation</code>的自定义类；</li>
<li>将下载需要的网络请求（如<code>NSURLSessionDownloadTask</code>）作为其中的一个属性；</li>
</ul>
<ol>
<li>dispatch_queue_create()</li>
<li>NSURLSession</li>
</ol>
<p><strong>核心：All the other APIs -> model -> UI</strong></p>
<p><strong>这里附上苹果开发者论坛中，一位开发者与苹果开发者的关于<code>NSURLSession</code>的问答（2015年7月）。</strong></p>
<p>我需要在我的app中上传200张图片，<br>1.我该使用<code>NSURLSessionUploadTask</code>还是其他什么类？<br>答：<code>NSURLSessionUploadTask</code>.<br>2.为了让这些upload保持在background，我该做些什么？<br>答：把所有的upload扔进一个<code>NSURLSession</code>的background session中。<br>3.当app没有在运行的时候，我该做些什么？（没有明确回答）<br>4.针对以上3点，我该在<code>NSURLSession</code>外面包一层<code>NSOperation</code>以便于使用<code>NSOperationQueue</code>，还是说，iOS会有它自己的内部queue来正确处理<code>NSURLSession</code>对象们？<br>答：这个很难说。一般来说，我是<code>NSOperation</code>的死忠粉，但由于background session和app生命周期的交互方式，用<code>NSOperation</code>来解决<code>NSURLSession</code>的background session的问题却有些棘手。<br>具体来说，通常的流程是这样的：</p>
<p>1.你的app开始一堆后台传输；<br>2.用户把它移到后台；<br>3.系统暂停了你的app；<br>4.传输在后台继续运行；<br>5.系统终止了你的app；<br>6.传输继续在后台运行；<br>7.传输结束；<br>8.系统重新启动你的app。</p>
<p>如果你使用<code>NSOperation</code>来追踪每个传输，当你在第8步重新启动app时，就需要重新创建那一堆的operation。当然，在第8步是需要重新创建<em>一些东西</em>，只是重新创建<code>NSOperation</code>要比重新创建其他不那么复杂的对象棘手些。</p>
<p>5.你的意思是说，如果我一次性把200个<code>NSURLSessionUploadTask</code>的实例添加到同一个background session配置的<code>NSURLSession</code>中，iOS会把它们都正确处理好？<br>答：是的。<code>NSURLSession</code>后台下载系统会很乐意处理几百个请求的。它在内部将它们串联起来，所以在任何时候只有少量的请求是在执行中。<br>6.如果是的话，对于task的数量是否有所限制？<br>答：没有硬性规定，但我通常建议不要做的太过分。在我看来，几百个请求是可以接受的，几千个请求就有点勉强，上万的请求就有点2。。我通常建议，如果你不得不处理上千个单独的item，你可以把它们打包起来，然后进行一个可恢复的传输。然而，有一些问题：</p>
<ul>
<li>做这种事情需要严谨的服务器端的支持。<ul>
<li><code>NSURLSession</code>的background session自动处理下载的断点续传。但对于上传并非如此。如果你需要上传的断点续传，你就得涉及到每次的连接数据（这里原文用的是”tears”，不太理解。。）。考虑到这个原因，把上传文件打包成合理大小的整块文件就很有必要，这样上传就会产生一打的进度，即使有可能连接失败，也好过你的app重新恢复上传。</li>
</ul>
</li>
</ul>
<p><strong>另外，对于如何知道当前并行的下载数，<code>MZDownloadManager</code>的作者也在这个issue下给出了<a href="https://github.com/mzeeshanid/MZDownloadManager/issues/29" target="_blank" rel="external">答案</a>。简而言之，就是通过筛选存储着model的array，得到状态为“下载中”的model的数量。</strong> </p>
<hr>
<p><strong>Ref:</strong></p>
<ul>
<li><a href="https://forums.developer.apple.com/thread/10239" target="_blank" rel="external">https://forums.developer.apple.com/thread/10239</a></li>
</ul>

        </div></article>
      <article class="post">
    <header class="post-header">
      <h1 class="post-title"><a class="post-link" href="/2017/01/10/background-fetch/">Background fetch</a>
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2017-01-10
        </span></div>
    </header>

    <div class="post-content"><p>如下是iOS7开始支持的background fetch在下载管理中的应用。</p>
<p>1.Target -> Capabilities -> Background Modes，打开开关，勾选<code>Background fetch</code>一项。<br>2.在负责下载管理的<code>CDDownloadManager</code>，或是<code>AppDelegate</code>中，添加<code>@property (nonatomic, copy) void (^savedCompletionHandler)();</code>属性，用于临时存储<code>application:handleEventsForBackgroundURLSession:completionHandler:</code>传入的block（详细说明见后文）。<br>3.在<code>AppDelegate.m</code>中添加如下方法：<br><figure class="highlight erlang"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">- <span class="params">(void)</span>application:<span class="params">(UIApplication *)</span>application handleEventsForBackgroundURLSession:<span class="params">(NSString *)</span>identifier completionHandler:<span class="params">(void (^)</span><span class="params">()</span>)completionHandler</div><div class="line">&#123;</div><div class="line">    NSLog<span class="params">(@<span class="string">"%s"</span>,__FUNCTION__)</span>;</div><div class="line"></div><div class="line">    [CDDownloadManager sharedManager].savedCompletionHandler = completionHandler;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在iOS中，当后台传输结束或是需要认证时，如果你的app不是正在运行的状态，它就会自动在后来重新启动，然后app的<code>UIApplicationDelegate</code> 会收到<code>application:handleEventsForBackgroundURLSession:completionHandler:</code>消息。这个函数中包括导致app启动的session的identifier。你的app应该在用相同的identifier创建后台configuration对象之前，把这个completion handler存下来。新创建的session会自动和正在执行的后台活动关联起来。</p>
<p>4.在<code>CDDownloadManager.m</code>，或是其他创建了<code>NSURLSession</code>实例的类中，实现如下方法：<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)URLSessionDidFinishEventsForBackgroundURLSession:(<span class="built_in">NSURLSession</span> *)session</div><div class="line">&#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%s"</span>, __FUNCTION__);</div><div class="line"></div><div class="line">    [<span class="keyword">self</span>.session getTasksWithCompletionHandler:^(<span class="built_in">NSArray</span>&lt;<span class="built_in">NSURLSessionDataTask</span> *&gt; * _Nonnull dataTasks, <span class="built_in">NSArray</span>&lt;<span class="built_in">NSURLSessionUploadTask</span> *&gt; * _Nonnull uploadTasks, <span class="built_in">NSArray</span>&lt;<span class="built_in">NSURLSessionDownloadTask</span> *&gt; * _Nonnull downloadTasks) &#123;</div><div class="line">        <span class="keyword">if</span> (downloadTasks.count == <span class="number">0</span>) &#123;</div><div class="line">            <span class="comment">// A.</span></div><div class="line">            <span class="keyword">if</span> (<span class="keyword">self</span>.savedCompletionHandler != <span class="literal">nil</span>) &#123;</div><div class="line">                <span class="keyword">void</span>(^completionHandler)() = <span class="keyword">self</span>.savedCompletionHandler;</div><div class="line"></div><div class="line">                <span class="keyword">self</span>.savedCompletionHandler = <span class="literal">nil</span>;</div><div class="line"></div><div class="line">                <span class="comment">// B.</span></div><div class="line">                [[<span class="built_in">NSOperationQueue</span> mainQueue] addOperationWithBlock:^&#123;</div><div class="line">                    completionHandler();</div><div class="line">                    <span class="comment">// C.</span></div><div class="line">                    UNMutableNotificationContent *content = [[UNMutableNotificationContent alloc] init];</div><div class="line">                    content.title = <span class="string">@"Calios said:"</span>;</div><div class="line">                    content.body = <span class="string">@"Hi, what about enjoy Swift in 2017?"</span>;</div><div class="line">                    content.sound = [UNNotificationSound defaultSound];</div><div class="line">                    content.badge = @([[<span class="built_in">UIApplication</span> sharedApplication] applicationIconBadgeNumber] + <span class="number">1</span>);</div><div class="line"></div><div class="line">                    UNTimeIntervalNotificationTrigger *trigger = [UNTimeIntervalNotificationTrigger triggerWithTimeInterval:<span class="number">5.</span>f repeats:<span class="literal">NO</span>];</div><div class="line">                    UNNotificationRequest *request = [UNNotificationRequest requestWithIdentifier:<span class="string">@"FiveSecond"</span> content:content trigger:trigger];</div><div class="line"></div><div class="line">                    UNUserNotificationCenter *center = [UNUserNotificationCenter currentNotificationCenter];</div><div class="line">                    [center addNotificationRequest:request withCompletionHandler:^(<span class="built_in">NSError</span> * _Nullable error) &#123;</div><div class="line">                        <span class="keyword">if</span> (!error) &#123;</div><div class="line">                            <span class="built_in">NSLog</span>(<span class="string">@"add notification request succeed!"</span>);</div><div class="line">                        &#125;</div><div class="line">                    &#125;];</div><div class="line">                &#125;];</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>对应上段代码的几点说明：<br>A. 这里的<code>self.savedCompletionHandler</code>就是上面在<code>AppDelegate.m</code>中被赋值的家伙。<br>B. 由于提供的completion handler是<code>UIKIt</code>的一部分，所以一定要在主线程中调用。<br>C. 这里的操作是在所有下载完成后弹出一个本地通知，并在console显示一行log。可以根据需求自行更改。<strong>注：</strong>iOS 10之后，本地通知和远程通知相关的接口都移到了<code>UserNotification</code>中，API也有很多变化，这里不再赘述，更多详情可参见喵神的<a href="https://onevcat.com/2016/08/notification/" target="_blank" rel="external">这篇博客</a>。</p>

        </div></article>
      <article class="post">
    <header class="post-header">
      <h1 class="post-title"><a class="post-link" href="/2017/01/10/notes-for-block/">Block学习笔记</a>
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2017-01-10
        </span></div>
    </header>

    <div class="post-content"><h3 id="1-Block声明"><a href="#1-Block声明" class="headerlink" title="1.Block声明"></a>1.Block声明</h3><p>编译器和运行时让block中引用的所有变量都被保存下来，以备在block的所有副本的生命周期中使用。<br><figure class="highlight dart"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)block1</div><div class="line">&#123;</div><div class="line">    <span class="built_in">int</span> (^myTest)(<span class="built_in">int</span>) = ^(<span class="built_in">int</span> <span class="built_in">num</span>)&#123;</div><div class="line">        <span class="keyword">return</span> <span class="built_in">num</span> * <span class="built_in">num</span>;</div><div class="line">    &#125;;</div><div class="line">    NSLog(@<span class="string">"double: %d"</span>,myTest(<span class="number">9</span>));</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="2-在block中改变的外部变量，需要用-block声明"><a href="#2-在block中改变的外部变量，需要用-block声明" class="headerlink" title="2.在block中改变的外部变量，需要用__block声明"></a>2.在block中改变的外部变量，需要用<code>__block</code>声明</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)block2</div><div class="line">&#123;</div><div class="line">    <span class="built_in">NSArray</span> *stringsArray = @[ <span class="string">@"string 1"</span>,</div><div class="line">                               <span class="string">@"String 21"</span>, <span class="comment">// &lt;-</span></div><div class="line">                               <span class="string">@"string 12"</span>,</div><div class="line">                               <span class="string">@"String 11"</span>,</div><div class="line">                               <span class="string">@"Strîng 21"</span>, <span class="comment">// &lt;-</span></div><div class="line">                               <span class="string">@"Striñg 21"</span>, <span class="comment">// &lt;-</span></div><div class="line">                               <span class="string">@"String 02"</span> ];</div><div class="line"></div><div class="line">    <span class="built_in">NSLocale</span> *currentLocale = [<span class="built_in">NSLocale</span> currentLocale];</div><div class="line">    __block <span class="built_in">NSUInteger</span> orderedSameCount = <span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="built_in">NSArray</span> *diacriticInsensitiveSortArray = [stringsArray sortedArrayUsingComparator:^(<span class="keyword">id</span> string1, <span class="keyword">id</span> string2) &#123;</div><div class="line"></div><div class="line">        <span class="built_in">NSRange</span> string1Range = <span class="built_in">NSMakeRange</span>(<span class="number">0</span>, [string1 length]);</div><div class="line">        <span class="built_in">NSComparisonResult</span> comparisonResult = [string1 compare:string2 options:<span class="built_in">NSDiacriticInsensitiveSearch</span> range:string1Range locale:currentLocale];</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (comparisonResult == <span class="built_in">NSOrderedSame</span>) &#123;</div><div class="line">            orderedSameCount++;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> comparisonResult;</div><div class="line">    &#125;];</div><div class="line"></div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"diacriticInsensitiveSortArray: %@"</span>, diacriticInsensitiveSortArray);</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"orderedSameCount: %lu"</span>, (<span class="keyword">unsigned</span> <span class="keyword">long</span>)orderedSameCount);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="3-block支持不定个数的参数（variadic-arguments）"><a href="#3-block支持不定个数的参数（variadic-arguments）" class="headerlink" title="3.block支持不定个数的参数（variadic arguments）"></a>3.block支持不定个数的参数（variadic arguments）</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)block3</div><div class="line">&#123;</div><div class="line">    <span class="keyword">void</span> (^variadicParams)(<span class="built_in">NSString</span>*, ...) = ^(<span class="built_in">NSString</span> *format, ...) &#123;</div><div class="line">        <span class="keyword">id</span> eachObject;</div><div class="line">        va_list argumentList;   <span class="comment">// va_list是指向变量列表的指针</span></div><div class="line">        <span class="keyword">if</span> (format) &#123;   <span class="comment">// 第一个参数并不是变量列表中的一个</span></div><div class="line">            <span class="built_in">NSMutableArray</span> *tmpArray = [<span class="built_in">NSMutableArray</span> arrayWithObject:format];</div><div class="line">            va_start(argumentList, format); <span class="comment">// 初始化va_list，并让它指向传入的参数（format）后面紧跟的第一个参数</span></div><div class="line">            <span class="keyword">while</span> ((eachObject = va_arg(argumentList, <span class="keyword">id</span>)) != <span class="literal">nil</span>)&#123;  <span class="comment">//   va_arg，取出列表中的下一个参数。必须指明参数的类型（这样va_arg才能知道该给它分配多少空间）</span></div><div class="line">                [tmpArray addObject:eachObject];    <span class="comment">// 不会把任何nil对象添加到tmpArray中</span></div><div class="line">            &#125;</div><div class="line">            va_end(argumentList);   <span class="comment">// 释放va_list这个数据结构所持有的任何内存</span></div><div class="line">            <span class="built_in">NSLog</span>(<span class="string">@"variadic params: %@"</span>,tmpArray);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    variadicParams(<span class="string">@"11"</span>,<span class="string">@"22"</span>,<span class="string">@"333"</span>,<span class="string">@"666"</span>,<span class="literal">nil</span>);  <span class="comment">//   Calios:这里最后一个参数必须传nil，args必须有最后一个结尾，否则是无法判断的。But，why？</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="4-几种类型的变量与block的交互"><a href="#4-几种类型的变量与block的交互" class="headerlink" title="4.几种类型的变量与block的交互"></a>4.几种类型的变量与block的交互</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSInteger</span> CounterGlobal;    <span class="comment">//   Calios:It throws out error for not finding CounterGlobal if extern is added. But, why?</span></div><div class="line"><span class="keyword">static</span> <span class="built_in">NSInteger</span> CounterStatic;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)block4</div><div class="line">&#123;</div><div class="line">    <span class="built_in">NSInteger</span> localCounter = <span class="number">42</span>;</div><div class="line">    __block <span class="keyword">char</span> localCharacter;</div><div class="line"></div><div class="line">    <span class="keyword">void</span> (^aBlock)(<span class="keyword">void</span>) = ^(<span class="keyword">void</span>) &#123;</div><div class="line">        ++CounterGlobal;</div><div class="line">        ++CounterStatic;</div><div class="line">        CounterGlobal = localCounter; <span class="comment">// localCounter fixed at block creation</span></div><div class="line">        localCharacter = <span class="string">'a'</span>; <span class="comment">// sets localCharacter in enclosing scope</span></div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    ++localCounter; <span class="comment">// unseen by the block</span></div><div class="line">    localCharacter = <span class="string">'b'</span>;</div><div class="line"></div><div class="line">    aBlock(); <span class="comment">// execute the block</span></div><div class="line">    <span class="comment">// localCharacter now 'a'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="5-当block被复制的时候，它会对block中使用的对象变量产生强引用。"><a href="#5-当block被复制的时候，它会对block中使用的对象变量产生强引用。" class="headerlink" title="5.当block被复制的时候，它会对block中使用的对象变量产生强引用。"></a>5.当block被复制的时候，它会对block中使用的对象变量产生强引用。</h3><p>如果你在一个方法的实现中使用了block：</p>
<ul>
<li>如果你使用了实例变量的引用，那么就对 <strong>self</strong> 产生了强引用；</li>
<li>如果你使用了实例变量的值，那么就对 <strong>该变量</strong> 产生了强引用。<figure class="highlight livescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">	- (<span class="literal">void</span>)block5</div><div class="line">	&#123;</div><div class="line"><span class="literal">void</span> (^doSomethingWithObject)(id) = ^(id <span class="keyword">var</span>)&#123;</div><div class="line">	NSLog(@<span class="string">"do something: %@"</span>,<span class="keyword">var</span>);</div><div class="line">&#125;;</div><div class="line">dispatch<span class="string">\_queue\_t</span> queue = dispatch<span class="string">\_queue\_create("com.calios.BlockSample.someQueue",</span> DISPATCH<span class="string">\_QUEUE\_SERIAL);</span></div><div class="line">dispatch<span class="string">\_async(queue,</span> ^&#123;    <span class="regexp">// dispatch\_async()是将block拷贝到指定的queue中，而复制操作（Block\_copy()）会将block移动到堆上。</span></div><div class="line">	// instanceVariable <span class="keyword">is</span> used <span class="keyword">by</span> reference, a strong reference <span class="keyword">is</span> made <span class="keyword">to</span> self</div><div class="line">	doSomethingWithObject(instanceVariable);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"></div><div class="line">id localVariable = instanceVariable;</div><div class="line">dispatch<span class="string">\_async(queue,</span> ^&#123;</div><div class="line">	<span class="comment">/*</span></div><div class="line">	 localVariable is used by value, a strong reference is made to localVariable</div><div class="line">	 (and not to self).</div><div class="line">	 */</div><div class="line">	doSomethingWithObject(localVariable);</div><div class="line">&#125;);</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="6-应该避免的做法"><a href="#6-应该避免的做法" class="headerlink" title="6.应该避免的做法"></a>6.应该避免的做法</h3><p>block字面量（即^{ … }）是代表这个block的局部栈数据结构的地址。因此，局部栈数据结构的作用于就是仅限于大括号中的语句，所以你应 <strong>避免</strong> 向下面这样使用block。<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)block6</div><div class="line">&#123;</div><div class="line">    dontDoThis();</div><div class="line">    dontDoThisEither();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">dontDoThis</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">void</span> (^blockArray[<span class="number">3</span>])(<span class="keyword">void</span>);  <span class="comment">// an array of 3 block references</span></div><div class="line"></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; ++i) &#123;</div><div class="line">        blockArray[i] = ^&#123; <span class="built_in">printf</span>(<span class="string">"hello, %d\n"</span>, i); &#125;;</div><div class="line">        <span class="comment">// WRONG: The block literal scope is the "for" loop.</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">dontDoThisEither</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">void</span> (^block)(<span class="keyword">void</span>);</div><div class="line"></div><div class="line">    <span class="keyword">int</span> i = arc4random() % <span class="number">1024</span>;</div><div class="line">    <span class="keyword">if</span> (i &gt; <span class="number">1000</span>) &#123;</div><div class="line">        block = ^&#123; <span class="built_in">printf</span>(<span class="string">"got i at: %d\n"</span>, i); &#125;;</div><div class="line">        <span class="comment">// WRONG: The block literal scope is the "then" clause.</span></div><div class="line">    &#125;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<hr>
<p><strong>Ref:</strong></p>
<ul>
<li><a href="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/Blocks/Articles/00_Introduction.html" target="_blank" rel="external">https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/Blocks/Articles/00_Introduction.html</a></li>
</ul>

        </div></article>
      <article class="post">
    <header class="post-header">
      <h1 class="post-title"><a class="post-link" href="/2017/01/10/at-the-beginning-of-2017/">写在2017年初</a>
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2017-01-10
        </span></div>
    </header>

    <div class="post-content"><p>在本地的Homebrew被我搞挂掉之后，博客休眠了两个多月。本地的草稿箱一直增加，online的内容一直没变化。实在不能忍了。</p>
<p>终于在2017年的第十天被我修理好了。继续第三年的blog之旅。</p>
<p><strong>但求把知识变成能力；</strong><br><strong>但求把枯涩的知识变成丰盈的语言；</strong><br><strong>但求我心依旧。</strong></p>
<p>—— Calios<br>2017.01.10</p>

        </div></article>
      <article class="post">
    <header class="post-header">
      <h1 class="post-title"><a class="post-link" href="/2016/10/28/back-button-in-custom-UINavigationBar/">浅析自定义UINavigationBar返回按钮（一）</a>
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2016-10-28
        </span></div>
    </header>

    <div class="post-content"><p><img src="http://7xkwcv.com1.z0.glb.clouddn.com/navbar.png" alt="" title="自定义navigationBar返回按钮"></p>
<p>这里主要有两个关键点：一是把原有的上一层的title去掉，二是把返回按钮的indicator图片换成自定义的。</p>
<p>对于第一点，解决办法是：</p>
<pre><code>[[UIBarButtonItem appearance] setBackButtonTitlePositionAdjustment:UIOffsetMake(0, -60) forBarMetrics:UIBarMetricsDefault];
</code></pre><p>对于第二点，有两个解决办法：</p>
<pre><code>// Solution 1:
UIImage *img = [UIImage imageNamed:@&quot;itm_back&quot;];
[UINavigationBar appearance].backIndicatorImage = img;
[UINavigationBar appearance].backIndicatorTransitionMaskImage = img;

// Solution 2:
[[UIBarButtonItem appearance] setBackButtonBackgroundImage:[img resizableImageWithCapInsets:UIEdgeInsetsMake(0, img.size.width - 1, 0, 0)] forState:UIControlStateNormal barMetrics:UIBarMetricsDefault];
</code></pre><p>对于第一个解决办法，需要注意的是，如果是自定义的back indicator image，<code>backIndicatorImage</code>和<code>backIndicatorTransitionMaskImage</code>必须成对出现，<a href="https://developer.apple.com/reference/uikit/uinavigationbar/1624938-backindicatortransitionmaskimage" target="_blank" rel="external">同时设置</a>。</p>
<p>对于第二个解决办法，需要注意的是，如果直接把<code>img</code>传进去，就会发现，图片被拉长了，变成了一柄剑。。。</p>
<p><img src="http://7xkwcv.com1.z0.glb.clouddn.com/navBar-sword.png" alt=""></p>
<p>而在<code>-setBackButtonBackgroundImage: forState: barMetrics</code>的api中，特意添加了注释提醒开发者：<code>backgroundImage must be a resizable image for good results.</code></p>
<p><img src="http://7xkwcv.com1.z0.glb.clouddn.com/nav-showFrame.png" alt=""></p>
<p>这里我的理解是，navigation bar返回按钮的图片+文字的placeholder有固定尺寸，当图片不够填充满这个区域的时候，会自动拉伸，所以注释中要求开发者传入一个可调整大小的图片作为参数。</p>
<p>而当我们调用<code>resizableImageWithCapInsets:</code>方法，并传入capInsets时，相当于锁定了cap insets的部分，让其余部分进行拉伸。在上面的代码中，设置capInsets为<code>UIEdgeInsetsMake(0, img.size.width, 0, 0)</code>，相当于保证原图片宽度范围内的图片不被拉伸，也就保证了原图片的显示效果。当然，调用<code>resizableImageWithCapInsets:</code>方法，<a href="https://developer.apple.com/reference/uikit/uiimage/1624102-resizableimagewithcapinsets" target="_blank" rel="external">实际上是返回了一张新图片，原有的图片是无法触及的</a>。</p>
<p>可以通过下面面包片模具的🌰来理解这个方法（嗯，吃货的思路就是这么独特。。～_～ ）：</p>
<p><img src="http://7xkwcv.com1.z0.glb.clouddn.com/bread.jpeg" alt=""></p>
<p>蓝色框范围内是原面包片（即原图片）；蓝色框和绿色框之间的面包边儿就是你设定的capInsets，这取决于你使用什么样的模具；而绿色框范围内是你可以自由发挥的部分，里面夹猕猴桃香蕉片随你（即可拉伸范围。。嗯，对于面包片是纵向的伸展）。</p>
<hr>
<p>以下引自苹果官方文档，列在此处，备查。</p>
<blockquote>
<p>从iOS5.0及之后，可以通过以下（自定义bar样式）列举的方法来自定义UINavigationBar的样式。你可以用<code>[UINavigationBar appearance]</code>来自定义所有UINavigationBar的样式，也可以只改变单独的一个。</p>
<p>在iOS 7中，UINavigationBar的<code>tintColor</code>会影响返回指示按钮的图片、按钮的标题和按钮的图片。<code>barTintColor</code>会影响bar本身的颜色。另外，navigation bar默认是半透明的。开关半透明的设置不会影响按钮，因为它们是没有背景的。</p>
<p>自定义bar样式：</p>
<ul>
<li><code>backIndicatorImage</code>：返回按钮边上的图片</li>
<li><code>backIndicatorTransitionMaskImage</code>：在push和pop过程中作为内容的蒙版的图片（@_@）</li>
<li><code>titleVerticalPositionAdjustmentForBarMetrics:</code>：对给定的横屏或竖屏的bar调整title的垂直方向的位置偏移。</li>
<li><code>titleTextAttributes</code>：bar的title的各种显示属性，如字体、颜色、阴影等。</li>
</ul>
</blockquote>
<hr>
<p><strong>Ref:</strong></p>
<ul>
<li><a href="https://developer.apple.com/reference/uikit/uinavigationbar" target="_blank" rel="external">https://developer.apple.com/reference/uikit/uinavigationbar</a></li>
<li><a href="https://developer.apple.com/reference/uikit/uibarbuttonitem?language=objc" target="_blank" rel="external">https://developer.apple.com/reference/uikit/uibarbuttonitem?language=objc</a></li>
<li><a href="http://stackoverflow.com/a/20986544/1594792" target="_blank" rel="external">http://stackoverflow.com/a/20986544/1594792</a></li>
<li><a href="http://stackoverflow.com/a/29937730/1594792" target="_blank" rel="external">http://stackoverflow.com/a/29937730/1594792</a></li>
</ul>

        </div></article>
      <article class="post">
    <header class="post-header">
      <h1 class="post-title"><a class="post-link" href="/2016/10/18/how-to-update-vim-in-Mac/">如何更新Mac中自带的Vim</a>
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2016-10-18
        </span></div>
    </header>

    <div class="post-content"><p>前几天翻卖桃君的公众号，温故了一下Vim 8.0的种种我目前也用不上的特性，竟是兴奋了一会儿，接着就开始考虑怎么把本机的Vim升级成8.0了。</p>
<p>根据SOF上的一个回答，步骤如下：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span><span class="bash"> <span class="comment"># Create the directories you need</span></span></div><div class="line"><span class="meta">$</span><span class="bash"> sudo mkdir -p /opt/<span class="built_in">local</span>/bin</span></div><div class="line"><span class="meta">$</span><span class="bash"> <span class="comment"># Download, compile, and install the latest Vim</span></span></div><div class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> ~</span></div><div class="line"><span class="meta">$</span><span class="bash"> hg <span class="built_in">clone</span> https://bitbucket.org/vim-mirror/vim or git <span class="built_in">clone</span> https://github.com/vim/vim.git</span></div><div class="line"><span class="meta">$</span><span class="bash"></span></div><div class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> vim</span></div><div class="line"><span class="meta">$</span><span class="bash"> ./configure --prefix=/opt/<span class="built_in">local</span></span></div><div class="line"><span class="meta">$</span><span class="bash"> make</span></div><div class="line"><span class="meta">$</span><span class="bash"> sudo make install</span></div><div class="line"><span class="meta">$</span><span class="bash"> <span class="comment"># Add the binary to your path, ahead of /usr/bin</span></span></div><div class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> <span class="string">'PATH=/opt/local/bin:$PATH'</span> &gt;&gt; ~/.bash_profile</span></div><div class="line"><span class="meta">$</span><span class="bash"> <span class="comment"># Reload bash_profile so the changes take effect in this window</span></span></div><div class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">source</span> ~/.bash_profile</span></div></pre></td></tr></table></figure></p>
<p><strong>注意：</strong></p>
<p><code>/usr/bin</code>路径下的文件，除非有明确的理由，否则不要改动。一旦操作失误，无法回退。所以，谨慎为妙。</p>
<hr>
<p><strong>Ref:</strong></p>
<ul>
<li><a href="http://stackoverflow.com/a/7211910/1594792" target="_blank" rel="external">http://stackoverflow.com/a/7211910/1594792</a></li>
</ul>

        </div></article>
      <nav class="pagination"><a class="prev" href="/page/2/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text">Prev</span>
      </a>
    <a class="next" href="/page/4/">
        <span class="next-text">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    </nav></section></div></div>
      </main>

      <footer id="footer" class="footer"><div class="social-links"><a href="mailto:calios_1124@163.com" class="iconfont icon-email" title="email"></a>
        <a href="http://github.com/caliosd" class="iconfont icon-github" title="github"></a>
        <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
    </div><div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://hexo.io/">Hexo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/ahonn/hexo-theme-even">Even</a>
  </span>

  <span class="copyright-year">&copy;2015 - 2020<span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Calios</span>
  </span>
</div>
</footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div><script type="text/javascript" src="/lib/jquery/jquery.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/src/even.js?v=2.11.0"></script>
</body>
</html>
