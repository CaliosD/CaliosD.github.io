<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222"/>






















<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0"/>

<link rel="stylesheet" href="/css/main.css?v=7.2.0"/>


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.2.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.2.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.2.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.2.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.2.0',
    sidebar: {"position":"left","display":"post","offset":12,"scrollpercent":false,"onmobile":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="Stedfast as thou art.">
<meta property="og:type" content="website">
<meta property="og:title" content="Calios&#39; Eden">
<meta property="og:url" content="http://www.caliosd.gq/page/9/index.html">
<meta property="og:site_name" content="Calios&#39; Eden">
<meta property="og:description" content="Stedfast as thou art.">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Calios&#39; Eden">
<meta name="twitter:description" content="Stedfast as thou art.">





  
  
  <link rel="canonical" href="http://www.caliosd.gq/page/9/"/>



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Calios' Eden</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Calios' Eden</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">Stedfast as thou art.</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    

    

    <a href="/" rel="section">Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    

    

    <a href="/archives/" rel="section">Archives</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    

    

    <a href="/about/" rel="section">About</a>

  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.caliosd.gq/2015/11/23/technical-preview/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Calios"/>
      <meta itemprop="description" content="Stedfast as thou art."/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Calios' Eden"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2015/11/23/technical-preview/" class="post-title-link" itemprop="url">“技术调研”时我们做些什么？</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 11/23/15 16:23:12" itemprop="dateCreated datePublished" datetime="2015-11-23T16:23:12+08:00">11/23/15</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 09/15/18 17:28:48" itemprop="dateModified" datetime="2018-09-15T17:28:48+08:00">09/15/18</time>
              </span>
            
          

          

          
            
            
          

          
          

          

          <br/>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近的一个项目涉及到视频播放，在一段时间的“技术调研”之后完成的项目的完整编码和测试。回过头看时，发现自己在所谓的“技术调研”阶段简直是在乱撞，毫无章法。因此总结一文于此。以备后查。</p>
<h4 id="脑洞开一下"><a href="#脑洞开一下" class="headerlink" title="脑洞开一下"></a>脑洞开一下</h4><p>和拍照相仿，都是需要一个主题，也就是要表现什么。同样，调研的主体要明确。比如说，要研究视频播放。那么，思维发散开来，视频播放涉及到哪些东西？（参考但并不仅限于下图）</p>
<p><img src="http://7xkwcv.com1.z0.glb.clouddn.com/What%27re%20we%20talking%20about%20with%20TR%20%3F.png" alt=""></p>
<p>终于，开始进入正题。</p>
<h4 id="As-A-…"><a href="#As-A-…" class="headerlink" title="As A …"></a>As A …</h4><p>作为一个视频播放的工具，要能播放视频（能够同时支持音频更好）。那么：</p>
<ul>
<li>视频来自哪里呢：要么是本地资源，要么是网络资源、流媒体一类。</li>
<li>能支持什么格式：mp4？m3u8？wav？mp3？</li>
</ul>
<blockquote>
<p>(PS: 打印audiovisualMIMETypes属性查看AVPlayer支持哪些格式：</p>
<p>“audio/aacp”,<br>“audio/mpeg3”,<br>“audio/mp3”,<br>“audio/x-caf”,<br>“audio/mpeg”,<br>“audio/x-mpeg3”,<br>“audio/wav”,<br>“audio/scpls”,<br>“audio/mp4”,<br>“audio/x-mpg”,<br>“audio/x-wav”,<br>“audio/x-aiff”,<br>“audio/x-m4p”,<br>“audio/x-scpls”,<br>“audio/x-mpegurl”,<br>“audio/x-aac”,<br>“audio/3gpp”,<br>“audio/basic”,<br>“audio/x-m4a”,<br>“audio/x-mpeg”,<br>“audio/wave”,<br>“audio/x-m4r”,<br>“audio/x-mp3”,<br>“audio/AMR”,<br>“audio/aiff”,<br>“audio/3gpp2”,<br>“audio/aac”,<br>“audio/mpg”,<br>“audio/mpegurl”,<br>“audio/x-m4b”,</p>
<p>“video/3gpp2”,<br>“video/quicktime”,<br>“video/mp4”,<br>“video/avi”,<br>“video/x-m4v”,<br>“video/3gpp”,</p>
<p>“text/vtt”,</p>
<p>“application/mp4”,<br>“application/x-mpegurl”<br>“application/vnd.apple.mpegurl”)</p>
</blockquote>
<ul>
<li>播放的场景：在应用中前台播放？扔到后台去了是自动暂停还是继续播放？</li>
<li>对于单一资源而言，要能够：<ul>
<li>播放／暂停；</li>
<li>改变播放进度；</li>
<li>音量控制；</li>
<li>全屏显示；</li>
<li>……</li>
</ul>
</li>
<li>对于多个资源而言，可能需要：<ul>
<li>视频队列的播放；</li>
<li>视频间的切换；</li>
<li>视频浏览；</li>
<li>……</li>
</ul>
</li>
</ul>
<h4 id="如何实现"><a href="#如何实现" class="headerlink" title="如何实现"></a>如何实现</h4><p>在iOS中，怎么实现这个播放视频的功能？</p>
<p><strong>1.需要系统的什么类库：</strong></p>
<ul>
<li>MediaPlayer.framework中的MPMoviePlayerController来实现的确简单，几句代码就够了，而且支持本地视频和网络视频，但是对于界面的自定义不强。pass掉。（<em>在iOS9开始被标记为了弃用，改用AVPlayerViewController了。</em>）</li>
<li>AVFoundation。AVPlayer存在于其中。它更接近底层，所以灵活性也更强。<em>但是，</em>AVPlayer本身并没有view属性，如果要显示必须创建一个播放器层AVPlayerLayer用于展示。*</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// DPlayerLayerView.h</span></div><div class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></div><div class="line"><span class="meta">#import <span class="meta-string">&lt;AVFoundation/AVFoundation.h&gt;</span></span></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">DPlayerLayerView</span> : <span class="title">UIView</span></span></div><div class="line"></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">AVPlayer</span> *player;</div><div class="line">-(<span class="keyword">void</span>)setVideoFillMode:(<span class="built_in">NSString</span> *)fillMode;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// DPlayerLayerView.m</span></div><div class="line"><span class="meta">#import <span class="meta-string">"DPlayerLayerView.h"</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">DPlayerLayerView</span></span></div><div class="line"></div><div class="line">+(Class)layerClass</div><div class="line">&#123;</div><div class="line">    <span class="keyword">return</span> [<span class="built_in">AVPlayerLayer</span> <span class="keyword">class</span>];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 单纯使用AVPlayer类是无法显示视频的，要将视频层添加至AVPlayerLayer中，这样才能将视频显示出来。</span></div><div class="line">-(<span class="built_in">AVPlayer</span> *)player</div><div class="line">&#123;</div><div class="line">    <span class="keyword">return</span> [(<span class="built_in">AVPlayerLayer</span> *)[<span class="keyword">self</span> layer] player];</div><div class="line">&#125;</div><div class="line"></div><div class="line">-(<span class="keyword">void</span>)setPlayer:(<span class="built_in">AVPlayer</span> *)player</div><div class="line">&#123;</div><div class="line">    [(<span class="built_in">AVPlayerLayer</span> *)[<span class="keyword">self</span> layer] setPlayer:player];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 指定video在player layer的bounds内如何显示。（默认是AVLayerVideoGravityResizeAspect）</span></div><div class="line"><span class="comment">/* 可选项：</span></div><div class="line"> * AVLayerVideoGravityResizeAspect，保证宽高比，在layer的bounds内正常显示；</div><div class="line"> * AVLayerVideoGravityResizeAspectFill，保证宽高比，填充满layer的bounds；</div><div class="line"> * AVLayerVideoGravityResize，拉伸来填满layer的bounds。</div><div class="line"> */</div><div class="line">-(<span class="keyword">void</span>)setVideoFillMode:(<span class="built_in">NSString</span> *)fillMode</div><div class="line">&#123;</div><div class="line">    <span class="built_in">AVPlayerLayer</span> *playerLayer = (<span class="built_in">AVPlayerLayer</span> *)[<span class="keyword">self</span> layer];</div><div class="line">    playerLayer.videoGravity = fillMode;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<ul>
<li>AVKit。iOS8以来的新秀。用来代替MPMoviePlayerViewController。基于AVFoundation。它提供了视频播放的UI，又可以播放任何来自AVFoundation的<code>AVPlayer</code>对象。（由于项目需要支持iOS7，所以，只能忍痛割爱T_T）</li>
</ul>
<p><strong>2.API</strong></p>
<p>之前把AVPlayer类中的方法梳理了一遍，<a href="http://www.calios.gq/2015/09/24/AVPlayer-Class-Reference/" title="http://www.calios.gq/2015/09/24/AVPlayer-Class-Reference/" target="_blank" rel="external">在这里</a>，AVPlayerItem和AVURLAsset时间允许的话也应该整理一下。比如AVPlayerItem中的<code>cancelPendingSeeks</code>和AVAsset中的<code>cancelLoading</code>，就帮我解决了一个困扰很久的问题。API就在那儿，不近不远。你看到了，就找到了光明；看不到，就继续在黑暗中摸索。</p>
<p><strong>3.来自苹果的demo</strong></p>
<p>这就是苹果赠予开发者的彩蛋啊。在网络上茫茫如海的资料中，官网demo永远是那个指引的灯塔，是经常让你感慨“原来可以这么写这么简单”的存在。</p>
<p>视频播放相关的demo有：</p>
<ul>
<li>MoviePlayer；</li>
<li>AVPlayerDemo；</li>
<li>AVLoupe。</li>
</ul>
<p>（PS：Xcode自带的Document其实很好用，Command ＋ Shift ＋ 数字0，调出来就可以直接搜索，可加标签，可看demo，和Dash的差别就是不能在这里看收藏的代码段，但是可以在Utility View中看啊～）</p>
<p><strong>4.其他教程</strong></p>
<p>能够在接触一个事物／模块的初期看到一篇通俗易懂、条理清晰的教程也是个幸运的事。以下列出几篇从中受益匪浅的，以此感谢各位作者。</p>
<p><a href="http://www.cnblogs.com/kenshincui/p/4186022.html" target="_blank" rel="external">http://www.cnblogs.com/kenshincui/p/4186022.html</a></p>
<p><a href="https://www.shinobicontrols.com/blog/ios8-day-by-day-day-26-avkit" target="_blank" rel="external">https://www.shinobicontrols.com/blog/ios8-day-by-day-day-26-avkit</a></p>
<h4 id="Trick-or-treat"><a href="#Trick-or-treat" class="headerlink" title="Trick or treat?"></a>Trick or treat?</h4><p>除了上面列出的基本功能外，还有一些可能现在不是必须、但很常见的功能点。比如：</p>
<ul>
<li>获取视频的缩略图；</li>
<li>清理缩略图的缓存；</li>
<li>资源的缓存；</li>
<li>本地视频资源的播放；</li>
<li>清理已下载资源的缓存；</li>
<li>资源队列；</li>
<li>跳到指定位置开始播放；</li>
<li>网络状况切换时的处理；</li>
<li>限制带宽的情况下，对于码流和清晰度的支持(一般来说，如果是IM的宽带，在网上只能看不超过128kbps的视频，超过128kbps的视频只能等视频缓冲才能顺利观看。)；</li>
<li>……</li>
</ul>
<h4 id="其他相关"><a href="#其他相关" class="headerlink" title="其他相关"></a>其他相关</h4><p>对于视频有以上的问题需要考虑，那么其他相关的呢？比如：</p>
<ul>
<li>音频的播放？AVPlayer本身可以播放mp3等格式的音频；同属AVFoundation中的<code>AVAudioPlayer</code>也可以播放音频，但仅限于本地文件。</li>
<li>在音频/视频播放时，对于耳机的支持？</li>
<li>尤其是视频的播放时，对于AirPlay的支持？</li>
<li>……</li>
</ul>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>本文并没有很详细的列出在处理视频播放时具体的API，更多的是想给之后类似的“技术调研”提供一种思考的模式，不至于上来就一头乱撞。实现一个功能不难，通过实现功能来训练自己的思维能力，才能让自己更有效率的提升吧。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.caliosd.gq/2015/11/19/grep-useful-commands/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Calios"/>
      <meta itemprop="description" content="Stedfast as thou art."/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Calios' Eden"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2015/11/19/grep-useful-commands/" class="post-title-link" itemprop="url">grep常用命令及举例</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 11/19/15 18:35:48" itemprop="dateCreated datePublished" datetime="2015-11-19T18:35:48+08:00">11/19/15</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 09/15/18 16:48:36" itemprop="dateModified" datetime="2018-09-15T16:48:36+08:00">09/15/18</time>
              </span>
            
          

          

          
            
            
          

          
          

          

          <br/>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>原文链接：<a href="http://www.thegeekstuff.com/2009/03/15-practical-unix-grep-command-examples/" title="http://www.thegeekstuff.com/2009/03/15-practical-unix-grep-command-examples/" target="_blank" rel="external">http://www.thegeekstuff.com/2009/03/15-practical-unix-grep-command-examples/</a></p>
<hr>
<p>1.忽略大小写 -i<br><figure class="highlight delphi"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">语法：grep -i “<span class="keyword">string</span>” <span class="keyword">FILE</span></div></pre></td></tr></table></figure></p>
<p>2.查找完整的单词，而不是子字符串 -w<br>3.展示匹配后的N行<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">语法：<span class="keyword">grep</span> -A <span class="symbol">&lt;N&gt;</span> “<span class="built_in">string</span>” FILE</div><div class="line"></div><div class="line">$ <span class="keyword">grep</span> -A <span class="number">3</span> -i “example” demo_text</div></pre></td></tr></table></figure></p>
<p>4.展示匹配前的N行<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">语法：<span class="keyword">grep</span> -B <span class="symbol">&lt;N&gt;</span> “<span class="built_in">string</span>” FILENAME</div><div class="line"></div><div class="line">$ <span class="keyword">grep</span> -B <span class="number">2</span> “single” demo_text</div></pre></td></tr></table></figure></p>
<p>5.展示匹配附近的N行<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span><span class="bash"> grep -C “Example” demo_text</span></div></pre></td></tr></table></figure></p>
<p>6.高亮显示搜索关键词 GREP_OPTIONS<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ <span class="builtin-name">export</span> <span class="attribute">GREP_OPTIONS</span>=‘--color=auto’ <span class="attribute">GREP_COLOR</span>=‘100;8’</div></pre></td></tr></table></figure></p>
<p>7.递归搜索所有文件 -r<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span><span class="bash"> grep -r “remiss” *</span></div></pre></td></tr></table></figure></p>
<p>8.计算匹配的数量 -c<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">语法：<span class="keyword">grep</span> -<span class="keyword">c</span> “pattern” filename</div><div class="line"></div><div class="line">$ <span class="keyword">grep</span> -<span class="keyword">c</span> “<span class="keyword">go</span>” demo_text</div><div class="line"><span class="number">3</span></div></pre></td></tr></table></figure></p>
<p>9.只显示匹配规则的文件名字 -l<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ <span class="keyword">grep</span> -l <span class="keyword">this</span> demo_*</div><div class="line">demo_file</div><div class="line">demo_file1</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.caliosd.gq/2015/11/19/shortcuts-in-Vimium/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Calios"/>
      <meta itemprop="description" content="Stedfast as thou art."/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Calios' Eden"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2015/11/19/shortcuts-in-Vimium/" class="post-title-link" itemprop="url">Vimium(Chrome扩展)常用按键列表</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 11/19/15 17:23:04" itemprop="dateCreated datePublished" datetime="2015-11-19T17:23:04+08:00">11/19/15</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 09/15/18 16:10:37" itemprop="dateModified" datetime="2018-09-15T16:10:37+08:00">09/15/18</time>
              </span>
            
          

          

          
            
            
          

          
          

          

          <br/>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="当前页面的导航："><a href="#当前页面的导航：" class="headerlink" title="当前页面的导航："></a>当前页面的导航：</h4><table>
<thead>
<tr>
<th>按键</th>
<th>作用 </th>
</tr>
</thead>
<tbody>
<tr>
<td>?</td>
<td>显示帮助对话框，列出所有可用按键  </td>
</tr>
<tr>
<td>h</td>
<td>向左滚  </td>
</tr>
<tr>
<td>j</td>
<td>向下滚  </td>
</tr>
<tr>
<td>k</td>
<td>向上滚  </td>
</tr>
<tr>
<td>l</td>
<td>向右滚  </td>
</tr>
<tr>
<td>gg</td>
<td>滚到页首  </td>
</tr>
<tr>
<td>G</td>
<td>滚到页尾  </td>
</tr>
<tr>
<td>d</td>
<td>向下滚半屏 J</td>
</tr>
<tr>
<td>u</td>
<td>向上滚半屏</td>
</tr>
<tr>
<td>f</td>
<td>在当前标签打开链接</td>
</tr>
<tr>
<td>F</td>
<td>在新标签打开链接</td>
</tr>
<tr>
<td>r</td>
<td>重新加载</td>
</tr>
<tr>
<td>gs</td>
<td>查看源代码</td>
</tr>
<tr>
<td>i</td>
<td>进入insert模式 —— 所有命令都会被忽略，直到你按下Esc来退出</td>
</tr>
<tr>
<td>yy</td>
<td>将当前url复制到剪切板</td>
</tr>
<tr>
<td>yf</td>
<td>将一个url复制到剪切板</td>
</tr>
</tbody>
</table>
<h4 id="导航至新页面："><a href="#导航至新页面：" class="headerlink" title="导航至新页面："></a>导航至新页面：</h4><table>
<thead>
<tr>
<th>按键</th>
<th>作用 </th>
</tr>
</thead>
<tbody>
<tr>
<td>o</td>
<td>打开url，书签，或者历史记录</td>
</tr>
<tr>
<td>O</td>
<td>在新标签打开url，书签，或者历史记录</td>
</tr>
<tr>
<td>b</td>
<td>打开书签</td>
</tr>
<tr>
<td>B</td>
<td>在新标签打开书签</td>
</tr>
</tbody>
</table>
<h4 id="使用查找："><a href="#使用查找：" class="headerlink" title="使用查找："></a>使用查找：</h4><table>
<thead>
<tr>
<th>按键</th>
<th>作用 </th>
</tr>
</thead>
<tbody>
<tr>
<td>/</td>
<td>进入查找模式 —— 输入你查找的内容，按enter开始搜索，或者Esc退出</td>
</tr>
<tr>
<td>n</td>
<td>向前循环查找下一个匹配项</td>
</tr>
<tr>
<td>N</td>
<td>向后循环查找前一个匹配项</td>
</tr>
</tbody>
</table>
<p>对于高级用法，可以查看wiki中的<a href="https://github.com/philc/vimium/wiki/Find-Mode" title="https://github.com/philc/vimium/wiki/Find-Mode" target="_blank" rel="external">正则表达式</a>。</p>
<h4 id="导航历史："><a href="#导航历史：" class="headerlink" title="导航历史："></a>导航历史：</h4><table>
<thead>
<tr>
<th>按键</th>
<th>作用 </th>
</tr>
</thead>
<tbody>
<tr>
<td>H</td>
<td>回退到历史中的上一页</td>
</tr>
<tr>
<td>L</td>
<td>前进到历史中的下一页</td>
</tr>
</tbody>
</table>
<h4 id="操作标签："><a href="#操作标签：" class="headerlink" title="操作标签："></a>操作标签：</h4><table>
<thead>
<tr>
<th>按键</th>
<th>作用 </th>
</tr>
</thead>
<tbody>
<tr>
<td>J,gT</td>
<td>前往左边一个标签</td>
</tr>
<tr>
<td>K,gt</td>
<td>前往右边一个标签</td>
</tr>
<tr>
<td>g0</td>
<td>前往第一个标签</td>
</tr>
<tr>
<td>g$</td>
<td>前往最后一个标签</td>
</tr>
<tr>
<td>t</td>
<td>新建标签</td>
</tr>
<tr>
<td>yt</td>
<td>复制当前标签</td>
</tr>
<tr>
<td>x</td>
<td>关闭当前标签</td>
</tr>
<tr>
<td>X</td>
<td>重新打开关闭的标签</td>
</tr>
<tr>
<td>T</td>
<td>在打开的标签中搜索</td>
</tr>
<tr>
<td>\<a-p\></a-p\></td>
<td>钉住/取消钉住当前标签</td>
</tr>
</tbody>
</table>
<h4 id="切换模式"><a href="#切换模式" class="headerlink" title="切换模式"></a>切换模式</h4><p>这里主要说visual mode（可视模式）和caret mode（光标模式）之间的切换。</p>
<p>比如说我在网站上阅读一篇文章，想选择并复制一段文字，这时我应该怎样操作？</p>
<ul>
<li>假设我是在normal mode（普通模式）下，按<code>v</code>即可进入可视模式，通过hjkl进行左下上右的选择，按<code>V</code>即可选择行；</li>
<li>假设我已经进入可视模式，但光标所在位置并不是我想选择的地方，可以按<code>c</code>进入光标模式，通过hjkl进行光标移动，再按<code>v/V</code>在合适的位置开始选择；</li>
<li>在可视模式下，按<code>o</code>可以将光标切换到选中内容到另一端。</li>
<li>查找（/）在光标模式和可视模式中也可以使用。</li>
</ul>
<hr>
<p><strong>Ref:</strong></p>
<p><a href="https://github.com/philc/vimium/issues/1642" title="https://github.com/philc/vimium/issues/1642" target="_blank" rel="external">Caret mode in Github vimiim issues</a></p>
<p><a href="https://github.com/philc/vimium/blob/master/README.md" target="_blank" rel="external">https://github.com/philc/vimium/blob/master/README.md</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.caliosd.gq/2015/11/19/how-not-to-crash-4-threading/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Calios"/>
      <meta itemprop="description" content="Stedfast as thou art."/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Calios' Eden"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2015/11/19/how-not-to-crash-4-threading/" class="post-title-link" itemprop="url">【译】如何避免程序崩溃 -4：线程（一）</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 11/19/15 10:46:16" itemprop="dateCreated datePublished" datetime="2015-11-19T10:46:16+08:00">11/19/15</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 09/15/18 17:37:52" itemprop="dateModified" datetime="2018-09-15T17:37:52+08:00">09/15/18</time>
              </span>
            
          

          

          
            
            
          

          
          

          

          <br/>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>原文链接：<a href="http://inessential.com/2015/05/22/how_not_to_crash_4_threading" title="http://inessential.com/2015/05/22/how_not_to_crash_4_threading" target="_blank" rel="external">http://inessential.com/2015/05/22/how_not_to_crash_4_threading</a></p>
<hr>
<p>有一个简单的规则：所有事情都在主线程上做。机器和设备如今都很快，你可以在主线程上做比你想象的多得多的事。</p>
<p>当你不必考虑并发的时候，那就是某种意义上的天堂了，因为并不存在并发的问题。</p>
<p>但是……</p>
<p>我是一个性能的推崇者。或者更贴切地说，我是个用户体验的推崇者，比反应迟钝更糟糕的是反应迟钝并且明显地阻塞在主线程。不要那么做。</p>
<p>我会讲解那件事。但是让我们先从主线程开始。</p>
<h4 id="主线程规则"><a href="#主线程规则" class="headerlink" title="主线程规则"></a>主线程规则</h4><p>我写的所有代码都希望运行在主线程上，并且除非特例，否则只运行在主线程上。（我们马上会讲到特例。）</p>
<p>这就解决了一堆的问题。比如说，我之前写过的一篇<a href="http://www.caliosd.gq/2015/11/16/how-not-to-crash-3-nsnotification/" title="http://www.caliosd.gq/2015/11/16/how-not-to-crash-3-nsnotification/">在dealloc中取消通知的注册</a>。有些人指出你不能保证dealloc在那个线程上被调用 —— 但是你实际上是可以的，对于任何运行在主线程上的给定对象，只在主线程上被引用。</p>
<p>这也就意味着，任何KVO的改变都会在主线程上传播，任何观察的对象都会运行在主线程上，同时等待来自主线程的通知。</p>
<p>不需要处理并发的好处简直是<em>巨大的</em>。我强烈建议你用这种方式写你整个应用，然后测试看是否有什么地方阻塞了主线程。如果没有，那就是完美了，你就可以结束战斗了。（当然，用合适的大量数据来测试。）</p>
<h4 id="生活在它们自己小圈子中的对象"><a href="#生活在它们自己小圈子中的对象" class="headerlink" title="生活在它们自己小圈子中的对象"></a>生活在它们自己小圈子中的对象</h4><p>如果 —— 只有如果 —— 当你发现主线程明显被阻塞时，你才应该想办法去清理阻塞。</p>
<p>第一选择是使用能够和你应用的其他部分彻底隔离的转换方式。举个处理JSON的例子。</p>
<p>当我从服务器获取JSON数据时，我喜欢把它转化成中间对象，以便之后可以归到模型对象中。原因如下：</p>
<ol>
<li>我不希望模型对象知道JSON的存在。</li>
<li>我希望能处理NSNull一类的值，日期转化，还有其他任何对象接手数据之前的所有其他的转化。</li>
</ol>
<p>所以我用一个NSOperationQueue或者GCD队列（最近通常是后者）来把服务器返回的NSData转化成中间对象。</p>
<p>（尽量使用队列。绝不要使用<code>detachThreadSelector</code>或者<code>performSelectorInBackground</code>。）</p>
<p>这些中间对象每次会被单一线程获取。它们在后台线程被创建，然后被传到主线程，在那里被用于更新模型，然后被丢弃。</p>
<p>因为它们在生命周期中被不同的线程引用，我确信这些对象除了它们自己之外什么都不知道，只知道被传入它们的init方法中的是神马。一旦在队列中被创建，它们就是不可变的了。它们不观察任何事，也没有人观察它们（毕竟，它们是不改变的）。</p>
<p>（从不改变的对象是线程安全的这个角度来看，那些对象是完全线程安全的。然而，没必要强迫线程安全，因为重要的是它们在单一线程的一次使用时是安全的，而非同时在多个线程。）</p>
<h4 id="对象和它的小伙伴"><a href="#对象和它的小伙伴" class="headerlink" title="对象和它的小伙伴"></a>对象和它的小伙伴</h4><p>有时候很多对象会协同工作。放下JSON，我们来考虑RSS解析器。在这个例子中，涉及到三个主要对象：一个SAX解析器的封装器，它的代理方法，和这个代理创建的中间对象。（概念上来说，和上面例子中的对象非常像。）</p>
<p>SAX解析器的封装器和它的代理的生命周期贯穿整个操作。它们不需要是线程安全的，尽管代码运行中单独的线程中 —— 因为它们<em>只</em>被那个线程获取。当它们在工作时，它们对外面的世界一无所知，而外面的世界对于它们也是一无所知。</p>
<ol>
<li>SAX解析器的封装器知道它初始化时候用的NSData，知道它有一个代理。</li>
<li>SAX解析器的封装器知道它创建的中间对象。</li>
<li>中间对象什么都不知道。</li>
</ol>
<p>于是，这些对象协同工作，但是，重要的是，它们从不使用KVO或者通知模式。它们使用代理模式来取而代之（或者使用block和函数在理论上都不重要）。</p>
<p>这些对象协同工作，但同时也尽可能地保持这个团队与它的任务独立地分离开。</p>
<p>最后，只有中间对象会留存下来 —— 它们被传回主线程，也就是在那里它们被用来更新模型。然后它们也被丢弃。</p>
<h4 id="最糟糕的场景"><a href="#最糟糕的场景" class="headerlink" title="最糟糕的场景"></a>最糟糕的场景</h4><p>我多次重复了“更新模型”这个词组，并提到在主线程做这件事。几年前我从没有梦想过可以这么干 —— 但电脑和设备已经变得如此迅速，以至于可以实现优先考虑只运行在主线程，然后，只有当处理能够、并且应该被安全挪到队列中的其他所有事情时，再考虑其他可选项。</p>
<p>你不会<em>真的</em>想要在后台线程中更新模型。它是个生产崩溃的机器。但是测试和性能剖析可能会告诉你你需要这么做。</p>
<p>试着解决这个问题。如果更新模型<em>除了</em>一件事外其他都好 —— 比如说，涉及到将NSData转换成UIImage或者NSImage —— 那就<em>仅仅把慢的那部分</em>挪到后台任务中。（通过data或者文件来创建图片，把这个挪出主线程实在是一件完美的事。它很容易被隔离开。）</p>
<p>可能有问题的是数据库：可能你发现它在内存中创建对象、更新属性都很快，即使有一堆也是如此。在那种场景中，你可能就会像我一样，把数据库的调用从主线程中分离出来。（并没有那么难：数据库需要在一系列的后台线程中运行，它要按照严格的顺序来执行那些主线程中的任务。）</p>
<p>也就是说：是存在其他可选项的。</p>
<p>但是如果你仍然发现你不得不在后台线程中更新模型，那就不得不这么做吧。切记你应用的其他部分是在主线程上，所以在发送通知或者做其他事情时，在主线程上处理。</p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>在主线程上做每件事。对于队列和后台线程想都不要想。享受天堂吧！</p>
<p>如果在测试和性能分析后，你发现自己不得不把一些东西挪到后台队列中，挑那些可以被完美分离的部分，并保证它们被完美隔离开。使用代理模式；不要使用KVO或者通知模式。</p>
<p>最后，如果你仍然需要走些野路子 —— 比如说在后台队列中更新你的模型 —— 切记你应用的其他部分要么是运行在主线程上，要么是不分割的整体，能让你在走野路子时不必考虑它们。然后：小心行事，不要乐观太早。（乐观主义者创造崩溃。）</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.caliosd.gq/2015/11/16/how-not-to-crash-3-nsnotification/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Calios"/>
      <meta itemprop="description" content="Stedfast as thou art."/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Calios' Eden"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2015/11/16/how-not-to-crash-3-nsnotification/" class="post-title-link" itemprop="url">【译】如何避免程序崩溃-3：NSNotification</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 11/16/15 14:31:40" itemprop="dateCreated datePublished" datetime="2015-11-16T14:31:40+08:00">11/16/15</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 09/15/18 17:37:49" itemprop="dateModified" datetime="2018-09-15T17:37:49+08:00">09/15/18</time>
              </span>
            
          

          

          
            
            
          

          
          

          

          <br/>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>原文链接：<a href="http://inessential.com/2015/05/21/how_not_to_crash_3_nsnotification" title="http://inessential.com/2015/05/21/how_not_to_crash_3_nsnotification" target="_blank" rel="external">http://inessential.com/2015/05/21/how_not_to_crash_3_nsnotification</a></p>
<hr>
<p>通常来说，和KVO与（特别是）绑定相比，我更喜欢NSNotification。我的确有时候用KVO —— 每当这时它都是那最敏感的部分。但是NSNotification像很多比较老的API一样，是很容易使用而不会导致崩溃的。</p>
<p>但是你还是要小心。</p>
<h4 id="一种导致崩溃的方式"><a href="#一种导致崩溃的方式" class="headerlink" title="一种导致崩溃的方式"></a>一种导致崩溃的方式</h4><p>当一个对象注册了一个通知，然后没有取消注册就被销毁了，然后应用就会在发送通知的时候崩溃掉。这是你需要避免的。文章余下的部分就来说说该怎么做。</p>
<h4 id="一条重要规则"><a href="#一条重要规则" class="headerlink" title="一条重要规则"></a>一条重要规则</h4><p>我有一条简单而粗暴有效的规则：<em>只在主线程</em> 发送NSNotification。无一例外。如果一些代码运行在另一个线程，而它需要发送一个通知，那它必须在主线程做这件事。</p>
<p>这就避免了所有你不希望的线程发来的通知所导致的问题。这样也避免了因为没有取消通知注册而带来的一团乱麻的情形。</p>
<p>一个应用基本上所有的代码都应在运行在主线程中。NSOperation或者GCD queue中运行的代码应该和其他所有代码分离开，当多个对象协同工作时应该用代理模式（用或者不用block）。</p>
<p>保证通知总是在主线程被发送应该是 <em>小菜一碟</em>。（我会在<a href="http://www.caliosd.gq/2015/11/19/how-not-to-crash-4-threading/">另一篇</a>《如何避免程序崩溃》系列的文章中详细将线程和队列。）</p>
<h4 id="批量取消注册"><a href="#批量取消注册" class="headerlink" title="批量取消注册"></a>批量取消注册</h4><p>有些人喜欢在<code>dealloc</code>中做些额外的维护工作，来精确地给每个NSNotification取消注册。你会看到这样的代码：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="selector-attr">[[NSNotificationCenter defaultCenter]</span> <span class="selector-tag">removeObserver</span><span class="selector-pseudo">:self</span> <span class="selector-tag">name</span><span class="selector-pseudo">:kSomeNotificationName</span> <span class="selector-tag">object</span><span class="selector-pseudo">:someObject</span>];</div><div class="line"><span class="selector-attr">[[NSNotificationCenter defaultCenter]</span> <span class="selector-tag">removeObserver</span><span class="selector-pseudo">:self</span> <span class="selector-tag">name</span><span class="selector-pseudo">:kSomeOtherNotificationName</span> <span class="selector-tag">object</span><span class="selector-pseudo">:someOtherObject</span>];</div><div class="line"><span class="selector-tag">etc</span>...</div></pre></td></tr></table></figure></p>
<p>你可以证明你写的是对的。但是简单扫一眼代码是不够的 —— 随着时间的增长，你不得不仔细思考自己的代码。</p>
<p>以后，你或者别人可能会添加另一个通知，然后忘了为那个通知调用<code>removeObserver</code>。然后，就崩溃了。</p>
<p>另一个问题是，未来接手的人可能不得不通读你的代码，仔细核查来确保每个注册的通知都被移除了。这就是痛点：手动工作而又易出错。</p>
<p>相反，经常这么写：<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="section">[NSNotificationCenter defaultCenter removeObserver:self]</span><span class="comment">;</span></div></pre></td></tr></table></figure></p>
<p>如果是印第安那·琼斯（《夺宝奇兵》的主角），他会这么做。</p>
<h4 id="当心多次注册"><a href="#当心多次注册" class="headerlink" title="当心多次注册"></a>当心多次注册</h4><p>如果一个对象注册了一个通知，然后又注册一遍，通知的处理函数会被调用两次。不会自动合并。</p>
<p>（这在过去的日子里经常发生在iOS中的viewDidLoad。人们会把注册代码放在那里 —— 但是，别忘了视图可以被卸载和重新加载，这就意味着对于同一个通知的多次注册。）</p>
<p>你的通知的处理函数应该对于被调用两次做相应处理。也不应该让给定对象注册两次相同的通知成为可能。二者都要注意。</p>
<h4 id="在init中注册，在dealloc中取消注册"><a href="#在init中注册，在dealloc中取消注册" class="headerlink" title="在init中注册，在dealloc中取消注册"></a>在init中注册，在dealloc中取消注册</h4><p>几乎在每种情况下，我都在init方法中注册观察者，然后在<code>dealloc</code>中移除观察者。如果我发现一个对象需要在它的生命周期里添加和移除观察者，我会视之为强壮的代码。</p>
<p>这是个很好的机会，1）要么是它并不是真正需要这么做 2）这个对象需要划分成更小的对象。</p>
<p>你知道对于一个给定的对象而言，init方法只会被调用一次。你也知道dealloc方法只会在没有其他对象引用这个对象时被调用一次。你可以使用这个知识点来保持注册和取消注册之间的平衡，而不必去思考或者跟踪它。如此简单。</p>
<h4 id="避免addObserverForName"><a href="#避免addObserverForName" class="headerlink" title="避免addObserverForName"></a>避免addObserverForName</h4><p>有些人喜欢<code>-[NSNotificationCenter addObserverForName: object: queue: usingBlock:]</code>。这感觉很时髦，因为是基于block的，而我们都喜欢block。（我确信）</p>
<p>但是这是个糟糕的主意。你可能本可以保留自己写的处理通知的方法，但是你也让你的整理工作更加糟糕，因为现在你就额外多了一个对象需要照看，又需要稍后调用<code>removeObserver</code>。这就意味着没有批量取消注册；它意味着你要回去做审核的工作，这就意味着你又多了一件事情要保障。</p>
<p>基于block的版本意味着你可以让注册和处理通知一起保留 —— 但是这么做的话，在整理工作和潜在崩溃方面的代价实在是太大了。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.caliosd.gq/2015/11/13/how-not-to-crash-2-mutation-exceptions/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Calios"/>
      <meta itemprop="description" content="Stedfast as thou art."/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Calios' Eden"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2015/11/13/how-not-to-crash-2-mutation-exceptions/" class="post-title-link" itemprop="url">【译】如何避免程序崩溃-2：可变对象的异常</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 11/13/15 18:37:46" itemprop="dateCreated datePublished" datetime="2015-11-13T18:37:46+08:00">11/13/15</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 09/15/18 17:37:46" itemprop="dateModified" datetime="2018-09-15T17:37:46+08:00">09/15/18</time>
              </span>
            
          

          

          
            
            
          

          
          

          

          <br/>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>原文链接：<a href="http://inessential.com/2015/05/16/how_not_to_crash_2_mutation_exceptions" target="_blank" rel="external">http://inessential.com/2015/05/16/how_not_to_crash_2_mutation_exceptions</a></p>
<hr>
<p>你从某处获取到一个集合并枚举它 —— 然后当你在改变这个集合的时候报错，因为它正在进行枚举。应用崩溃了。</p>
<p>你可以通过一个小技巧避免这种悲伤的命运：不要对可变的集合进行枚举操作。</p>
<h4 id="异议"><a href="#异议" class="headerlink" title="异议"></a>异议</h4><p>你可能持有某种合理的观点，说<em>真正</em>的答案是不要在对集合进行枚举的时候对可变的集合进行改变。你应该对于自己的应用有足够的了解，以便能够写出安全地对可变集合进行枚举的代码。</p>
<p>是的，你应该如此。你绝对应该如此。</p>
<p>然而：编写远离崩溃的代码就是在于消除疑点。就在于能够将错误的几率最小化，将未来的（由你或其他人带来的）改变引入崩溃的可能性最小化。</p>
<h4 id="可变集合不应该成为公有接口的一部分"><a href="#可变集合不应该成为公有接口的一部分" class="headerlink" title="可变集合不应该成为公有接口的一部分"></a>可变集合不应该成为公有接口的一部分</h4><p>一个对象拥有一个可变集合作为公有属性，这件事本来就应该尽量避免 —— 或者最好不要发生。可变集合应该被控制在对象内部。</p>
<p>（更进一步地说，公有的集合应该为只读。当然事实也并非总是如此。）</p>
<p>现在，它整体上可能是有一个公有集合，在内部又有一个可变的集合。想象一个跟踪operation的对象。它可能公有方法这么写：<br><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">@<span class="keyword">property</span><span class="title"> </span>(nonatomic, readonly) NSArray *<span class="keyword">operations</span>;</div></pre></td></tr></table></figure></p>
<p>内部私有方法这么写：<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">NSMutableArray</span> *mutableOperations;</div><div class="line">- (<span class="built_in">NSArray</span> *)operations &#123;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">self</span>.mutableOperations;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这是完全合情合理的代码：因为mutableOperations是一个NSMutableArray，它又同时是一个NSArray。（我多年来都这么写。我对自己说：”Hey，我是个过来人了。我能<em>应付的了</em>。“但是我没有意识到的是，成熟的开发者是为了减少出错的可能而写代码。）</p>
<h4 id="被指定为不可变的属性应该名副其实"><a href="#被指定为不可变的属性应该名副其实" class="headerlink" title="被指定为不可变的属性应该名副其实"></a>被指定为不可变的属性应该名副其实</h4><p>在上面的例子中，你声明<code>operations</code>是一个在任何时候都可以安全枚举的数组。另一个人 —— 或者就是你自己 —— 在六个月之后看这段代码时，完全不会意识到你正在获取的可变数组，并<em>不能</em>足够安全地进行枚举。</p>
<p>这就是实现名副其实的解决方案：<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">NSArray</span> *)operations &#123;</div><div class="line">  <span class="keyword">return</span> [<span class="keyword">self</span>.mutableOperations <span class="keyword">copy</span>];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>（如果为了表达得更清晰，把属性声明为copy也不会有影响，但是我承认我不经常这么做。让API的使用者完全清晰地知道正在发生什么应该是有好处的。）</p>
<p>你可能会翻回去引用性能或者内存使用的问题或者二者皆有 —— 而我必须承认：我是一个性能的推崇者，我会在Instruments上花费超乎常理的时间，仅为了能够让代码快速运行、没有不合理的内存消耗。我从来没有发现这么做有任何问题。如果你的应用出现性能或者内存消耗的问题，可能是其他问题导致的，而不是这些copy。（尽管你可以考虑使用<code>@autoreleasepool</code>来让这些copy不留存那么长时间。）</p>
<p>copy一下吧。</p>
<h4 id="彩蛋：不要相信他们的谎言"><a href="#彩蛋：不要相信他们的谎言" class="headerlink" title="彩蛋：不要相信他们的谎言"></a>彩蛋：不要相信他们的谎言</h4><p>我最近解决了一个在枚举NSTextStorage layoutManager时可变量的问题：<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>, <span class="keyword">copy</span>) <span class="built_in">NSArray</span> *layoutManagers;</div></pre></td></tr></table></figure></p>
<p><em>显然</em> 枚举是安全的。它是一个NSArray，它声明自己是个copy。漂亮。枚举走起。</p>
<p>但是，它骗我。在调试器里，我发现它是一个NSMutableArray（__NSArrayM）—— 而且它根本就不是一个copy。它是NSTextStorage的名为<code>_layoutManagers</code>的实例变量，这个变量被声明为一个NSMutableArray。</p>
<p>而在我的枚举的block代码里面，触发了layoutManagers的改变，然后应用就崩溃了。</p>
<p>答案是：对layoutManagers的副本进行枚举。问题就解决了。</p>
<p>常言道：如果你从别人的代码中获取一个集合，对副本进行枚举总没坏处，防患于未然嘛。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.caliosd.gq/2015/11/12/how-not-to-crash-1-kvo-and-manual-bind/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Calios"/>
      <meta itemprop="description" content="Stedfast as thou art."/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Calios' Eden"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2015/11/12/how-not-to-crash-1-kvo-and-manual-bind/" class="post-title-link" itemprop="url">【译】如何避免程序崩溃-1：KVO与手动绑定</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 11/12/15 15:07:17" itemprop="dateCreated datePublished" datetime="2015-11-12T15:07:17+08:00">11/12/15</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 09/15/18 17:37:43" itemprop="dateModified" datetime="2018-09-15T17:37:43+08:00">09/15/18</time>
              </span>
            
          

          

          
            
            
          

          
          

          

          <br/>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>原文链接：<a href="http://inessential.com/2015/05/14/how_not_to_crash_1_kvo_and_manual_bind" title="http://inessential.com/2015/05/14/how_not_to_crash_1_kvo_and_manual_bind" target="_blank" rel="external">http://inessential.com/2015/05/14/how_not_to_crash_1_kvo_and_manual_bind</a></p>
<hr>
<p>我最近在修复系统崩溃的bug —— 但是，与写如何修复bug相比，我想，写写如何在最初就避免创造崩溃的bug会更有意思一些。</p>
<p>在第一部分，我会谈谈KVO，手动绑定，引用循环和无效方法。</p>
<h4 id="绑定意味着永远不会失联"><a href="#绑定意味着永远不会失联" class="headerlink" title="绑定意味着永远不会失联"></a>绑定意味着永远不会失联</h4><p>iOS开发者没有这个，但是Mac开发者的小伙伴们有：我们可以把一个属性绑定在另一个属性上。我们可以实现这点，即当x.foo更新的时候，y.foo也随之更新。</p>
<p>NSKeyValueBinding.h在AppKit中。我们来看下<code>bind:toObject:withKeyPath:options:</code>.</p>
<p>假设有一个有着title属性的button。每当controller的title更新的时候，这个title属性也应该随之更新。我们假设controller拥有这个button。你可以这样写代码：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">static</span> NSString kTitleKey = @<span class="string">"title"</span>;</div><div class="line">[self.button <span class="string">bind:</span>kTitleKey <span class="string">toObject:</span>self <span class="string">withKeyPath:</span>kTitleKey <span class="string">options:</span>nil];</div></pre></td></tr></table></figure></p>
<p>非常方便，而且很有效。</p>
<p>同时，你也离崩溃不远了。</p>
<p>问题在于：这个绑定引用了<code>toObject</code>。这就意味着这个button有效地引用了controller。如果controller又引用它的button（它本该如此），那么就造成了引用循环。二者都不会成为僵尸，但是都会被废弃。</p>
<p>一种崩溃的方式 —— 这也是真实场景 —— 是如果这个被废弃的controller监听着一个通知（我们称之为BSNotification），并且当接收到BSNotification的时候<em>做了点事</em>，当它<em>做这点事</em>的时候它就会崩溃，因为它在理论上已经失效，而它不知道该怎么处理这种情况。</p>
<h4 id="KVO意味着必须每次都把每件事做到完全正确"><a href="#KVO意味着必须每次都把每件事做到完全正确" class="headerlink" title="KVO意味着必须每次都把每件事做到完全正确"></a>KVO意味着必须每次都把每件事做到完全正确</h4><p>让我们加上第三个对象，一个model。我们<em>真正</em>想要的是这样的流程：<br>modelObject.title的更新，会使controller.title更新，而controller.title的更新，会使button.title更新。</p>
<p>这次我们来用KVO。<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">NSString</span> *)title &#123;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">self</span>.modelObject.title;</div><div class="line">&#125;</div><div class="line">+ (<span class="built_in">NSSet</span> *)keyPaths​ForValues​AffectingTitle &#123;</div><div class="line">  <span class="keyword">return</span> [<span class="built_in">NSSet</span> setWithObject:​<span class="string">@"modelObject.title"</span>];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>好了 —— 现在我们有了完整的流程。当modelObject.title改变的时候，会影响controller.title，同时button.title也随之更新为正确的值。</p>
<p>非常方便，而且很有效。</p>
<p>当然，它会崩溃，在modelObject被释放的时候（因为modelObject的实例在它还是一个观察者的时候被释放了）。</p>
<p>如果反过来，controller引用modelObject（它可能应该如此），然后你就有了一个被废弃的第三个对象，它永远不会被释放，是个随着时间变化不断增长变大的讨厌家伙。</p>
<h4 id="一个并不那么漂亮的解决办法"><a href="#一个并不那么漂亮的解决办法" class="headerlink" title="一个并不那么漂亮的解决办法"></a>一个并不那么漂亮的解决办法</h4><p>controller可以有一个类似于<code>invalidate</code>这样名字的函数，用来打破引用循环。一旦打破，<code>dealloc</code>方法就会因为controller、它的button和它的model对象而被调用。</p>
<p>你可以这么写代码，以便在你知道你用完了controller的时候调用：<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">-(<span class="keyword">void</span>)invalidate &#123;</div><div class="line">  [<span class="keyword">self</span>.button unbind:kTitleKey];</div><div class="line">  <span class="keyword">self</span>.modelObject = <span class="literal">nil</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这就是这个解决办法不那么漂亮的地方：</p>
<p>引用计数是非常棒的解决方案 —— 它能保证在<code>dealloc</code>被调用的时候，没有哪个对象拥有对于这个即将释放的对象的强引用。这就使得<code>dealloc</code>成为一个移除观察者及其他类似需要移除的不错地点。</p>
<p>但是如果你使用了类似invalidate的函数，你就是在试图自己来接手引用计数这件事。你<em>不得不</em>调用invalidate，又不得不在<em>合适的</em>时候调用。你能对每一个拥有invalidate函数的对象做出永久的保证么？如果出现一些改变，不只有一个对象引用了controller，你该怎么办？谁来调用invalidate？什么时候调用？</p>
<p>那是一大堆额外需要考虑的工作，而编程的目的之一就是使错误尽可能的减少。依赖invalidate会使错误出现的可能<em>大大增加</em>。</p>
<h4 id="一个更好的解决办法"><a href="#一个更好的解决办法" class="headerlink" title="一个更好的解决办法"></a>一个更好的解决办法</h4><p>让我们回归到我们试图解决的问题上来：</p>
<p>modelObject.title的更新，会使controller.title更新，而controller.title的更新，会使button.title更新。</p>
<p>简而言之：controller知道modelObject和button，但是后两者之间并不知道彼此的存在，也不知道controller的存在。这就是我们怎么避开invalidate函数来解决问题。</p>
<p>在controller中，灭掉自定义getter。灭掉<code>keyPathsForValuesAffectingTitle</code>.灭掉<code>bind: toObject: withKeyPath: options:</code>的使用。</p>
<p>取而代之的是，创建自定义的setter —— 因为，无论如何，setter在改变的时候总是会被调用，所有需要解决的问题就是广播title属性的更新。<br><figure class="highlight xl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">-(void)setTitle:(NSString *)<span class="built_in">title</span> &#123;</div><div class="line">  _<span class="built_in">title</span> = <span class="built_in">title</span>;</div><div class="line">  self.button.<span class="built_in">title</span> = <span class="built_in">title</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>问题解决了一半：当controller.title改变时，button.title也随之改变。</p>
<p>我们不能对modelObject做同样的事情，因为它不知道controller的存在。所以反过来，让controller来观察modelObject.title。<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[self.modelObject <span class="string">addObserver:</span>self <span class="string">forKeyPath:</span> kTitleKey <span class="string">options:</span><span class="number">0</span> <span class="string">context:</span> kTitleContext];</div></pre></td></tr></table></figure></p>
<p>然后在KVO的观察函数里，监测kTitleContext，然后让<code>self.title = self.modelObject.title</code>。这会调用controller的<code>setTitle:</code>函数 —— 而该函数会更新button.title。</p>
<p>这个解决办法就不会存在引用循环的问题。还有一点移除的工作要做，但你可以在controller的<code>dealloc</code>函数中用一行代码了结：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[_modelObject <span class="string">removeObserver:</span> self <span class="string">forKeyPath:</span>kTitleKey <span class="string">context:</span> kTitleContext];</div></pre></td></tr></table></figure></p>
<h4 id="总结与建议"><a href="#总结与建议" class="headerlink" title="总结与建议"></a>总结与建议</h4><p>我们提出的解决方案避免了引用循环，不必时刻记得要调用invalidate函数，也不用担心调用的时机是否正确。这是更安全的代码。</p>
<p>更棒的是，它用了更少的代码，而且足够简洁。</p>
<p>一些建议：</p>
<ul>
<li>不要在任何场景中使用<code>bind: toObject: withKeyPath: options:</code>(iOS的小伙伴们：你们应该高兴自己没有这样的选择。也可以把它当做可能它之所以为Mac开发而非iOS的原因之一)。</li>
<li>当你广播数据更新时，用自定义的setter，而不是自定义getter（毕竟是在<em>setter</em>中更新的数据）。</li>
<li>避免invalidate这样的函数，尽量让引用计数做它自己的事情 —— 因为如果<em>你</em>是那个跟踪计数的角色，你多半会出错。（我发现我不是总能够避免invalidate这样的函数，但是可能性总是比你想的要多那么一点）</li>
<li>在思考你的应用中发生了什么时，任何形式的观察死锁都会带来困难：在任何时候它有足够理由出现时，都最好是准确的。一旦你有了足够多的这种藤蔓般无处不在的观察模式，你就建造了一个不见天日的丛林，对它的每一点改变都会让你如履薄冰。</li>
<li>理论上，绑定和KVO是为了解耦而生的，而实际上这种耦合就是那么紧密 —— 在某种程度上，如果没有更紧密的话 —— 更难debug，更难矫正。通常情况下，最好把观察模式明确写清（不要写成<code>keyPathsForValuesAffectingXyz</code>这种），避免在keyPath中出现”.”字符。</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.caliosd.gq/2015/11/12/how-not-to-crash-0-catalog/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Calios"/>
      <meta itemprop="description" content="Stedfast as thou art."/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Calios' Eden"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2015/11/12/how-not-to-crash-0-catalog/" class="post-title-link" itemprop="url">【译】如何避免程序崩溃-0：目录</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 11/12/15 15:05:02" itemprop="dateCreated datePublished" datetime="2015-11-12T15:05:02+08:00">11/12/15</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 09/15/18 17:37:40" itemprop="dateModified" datetime="2018-09-15T17:37:40+08:00">09/15/18</time>
              </span>
            
          

          

          
            
            
          

          
          

          

          <br/>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>原文索引：</p>
<p><a href="http://inessential.com/2015/05/14/how_not_to_crash_1_kvo_and_manual_bind" title="http://inessential.com/2015/05/14/how_not_to_crash_1_kvo_and_manual_bind" target="_blank" rel="external">#1: KVO与手动绑定</a><br><a href="http://inessential.com/2015/05/16/how_not_to_crash_2_mutation_exceptions" title="http://inessential.com/2015/05/16/how_not_to_crash_2_mutation_exceptions" target="_blank" rel="external">#2: 可变对象的异常</a><br><a href="http://inessential.com/2015/05/21/how_not_to_crash_3_nsnotification" title="http://inessential.com/2015/05/21/how_not_to_crash_3_nsnotification" target="_blank" rel="external">#3: NSNotification</a><br><a href="http://inessential.com/2015/05/22/how_not_to_crash_4_threading" title="http://inessential.com/2015/05/22/how_not_to_crash_4_threading" target="_blank" rel="external">#4: 线程</a><br><a href="http://inessential.com/2015/05/26/how_not_to_crash_5_threading_part_2" title="http://inessential.com/2015/05/26/how_not_to_crash_5_threading_part_2" target="_blank" rel="external">#5: 线程2</a><br><a href="http://inessential.com/2015/05/27/how_not_to_crash_6_properties_and_acce" title="http://inessential.com/2015/05/27/how_not_to_crash_6_properties_and_acce" target="_blank" rel="external">#6: 属性和存取器</a><br><a href="http://inessential.com/2015/05/29/how_not_to_crash_7_dealing_with_nothin" title="http://inessential.com/2015/05/29/how_not_to_crash_7_dealing_with_nothin" target="_blank" rel="external">#7: 什么都不做</a><br><a href="http://inessential.com/2015/06/10/how_not_to_crash_8_infrastructure" title="http://inessential.com/2015/06/10/how_not_to_crash_8_infrastructure" target="_blank" rel="external">#8: 基本架构</a><br><a href="http://inessential.com/2015/06/10/how_not_to_crash_9_mindset" title="http://inessential.com/2015/06/10/how_not_to_crash_9_mindset" target="_blank" rel="external">#9: 心态</a></p>
<hr>
<p>译文索引：</p>
<p><a href="http://www.caliosd.gq/2015/11/12/how-not-to-crash-1-kvo-and-manual-bind/" title="http://www.caliosd.gq/2015/11/12/how-not-to-crash-1-kvo-and-manual-bind/">#1: KVO与手动绑定</a><br><a href="http://www.caliosd.gq/2015/11/13/how-not-to-crash-2-mutation-exceptions/" title="http://www.caliosd.gq/2015/11/13/how-not-to-crash-2-mutation-exceptions/">#2: 可变对象的异常</a><br><a href="http://www.caliosd.gq/2015/11/16/how-not-to-crash-3-nsnotification/" title="http://www.caliosd.gq/2015/11/16/how-not-to-crash-3-nsnotification/">#3: NSNotification</a><br><a href="http://www.caliosd.gq/2015/11/19/how-not-to-crash-4-threading/" title="http://www.caliosd.gq/2015/11/19/how-not-to-crash-4-threading/">#4: 线程</a><br><a href="http://www.caliosd.gq/2015/11/26/how-not-to-crash-5-threading-part-2/" title="http://www.caliosd.gq/2015/11/26/how-not-to-crash-5-threading-part-2/">#5: 线程2</a><br><a href="http://www.caliosd.gq/2015/11/26/how-not-to-crash-6-properties-and-accessories/" title="http://www.caliosd.gq/2015/11/26/how-not-to-crash-6-properties-and-accessories/">#6: 属性和存取器</a><br><a href="http://www.caliosd.gq/2015/12/19/how-not-to-crash-7-dealing-with-nothing/" title="http://www.caliosd.gq/2015/12/19/how-not-to-crash-7-dealing-with-nothing/">#7: 什么都不做</a><br><a href="http://www.caliosd.gq/2016/01/21/how-not-to-crash-8-infrastructure/" title="http://www.caliosd.gq/2016/01/21/how-not-to-crash-8-infrastructure/">#8: 基本架构</a><br><a href="http://www.caliosd.gq/2016/02/24/how-not-to-crash-9-mindset/" title="http://www.caliosd.gq/2016/02/24/how-not-to-crash-9-mindset/">#9: 心态</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.caliosd.gq/2015/09/25/install-MongoDB-in-OS-X/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Calios"/>
      <meta itemprop="description" content="Stedfast as thou art."/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Calios' Eden"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2015/09/25/install-MongoDB-in-OS-X/" class="post-title-link" itemprop="url">OS X安装MongoDB</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 09/25/15 14:48:04" itemprop="dateCreated datePublished" datetime="2015-09-25T14:48:04+08:00">09/25/15</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 09/15/18 16:25:27" itemprop="dateModified" datetime="2018-09-15T16:25:27+08:00">09/15/18</time>
              </span>
            
          

          

          
            
            
          

          
          

          

          <br/>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在OS X中，使用<a href="http://brew.sh/" target="_blank" rel="external">Homebrew</a>完成各种package的安装工作无疑是很方便的。如下是使用Homebrew安装MongoDB的步骤。</p>
<h4 id="1-更新Homebrew的package数据库"><a href="#1-更新Homebrew的package数据库" class="headerlink" title="1.更新Homebrew的package数据库"></a>1.更新Homebrew的package数据库</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span><span class="bash"> brew update</span></div></pre></td></tr></table></figure>
<h4 id="2-安装MongoDB"><a href="#2-安装MongoDB" class="headerlink" title="2.安装MongoDB"></a>2.安装MongoDB</h4><figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">$ brew install mongodb</div><div class="line">==\&gt; Downloading https:<span class="comment">//homebrew.bintray.com/bottles/mongodb-3.0.6.yosemite.bottle.tar.gz</span></div><div class="line">###### \#\#########                                                          <span class="number">23.0</span>%</div><div class="line">curl: (<span class="number">56</span>) SSLRead() return error <span class="number">-9806</span></div><div class="line">Error: Failed to download resource <span class="string">"mongodb"</span></div><div class="line">Download failed: https:<span class="comment">//homebrew.bintray.com/bottles/mongodb-3.0.6.yosemite.bottle.tar.gz</span></div><div class="line">Warning: Bottle installation failed: building <span class="keyword">from</span> source.</div><div class="line">==\&gt; Downloading https:<span class="comment">//fastdl.mongodb.org/src/mongodb-src-r3.0.6.tar.gz</span></div><div class="line">###### \#\################################################################# <span class="number">100.0</span>%</div><div class="line">==\&gt; Cloning https:<span class="comment">//github.com/mongodb/mongo-tools.git</span></div><div class="line">Cloning into <span class="string">'/Library/Caches/Homebrew/mongodb--github.com-mongodb-mongo-tools--git'</span>...</div><div class="line">remote: Counting objects: <span class="number">1180</span>, done.</div><div class="line">remote: Compressing objects: <span class="number">100</span>% (<span class="number">950</span>/<span class="number">950</span>), done.</div><div class="line">remote: Total <span class="number">1180</span> (delta <span class="number">184</span>), reused <span class="number">840</span> (delta <span class="number">136</span>), pack-reused <span class="number">0</span></div><div class="line">Receiving objects: <span class="number">100</span>% (<span class="number">1180</span>/<span class="number">1180</span>), <span class="number">1.86</span> MiB | <span class="number">230.00</span> KiB/s, done.</div><div class="line">Resolving deltas: <span class="number">100</span>% (<span class="number">184</span>/<span class="number">184</span>), done.</div><div class="line">Checking connectivity... done.</div><div class="line">Note: checking out <span class="string">'7588eb887549bd5d2fc7bbc08f7c62d4b29b9d75'</span>.</div></pre></td></tr></table></figure>
<p>You are in ‘detached HEAD’ state. You can look around, make experimental<br>changes and commit them, and you can discard any commits you make in this<br>state without impacting any branches by performing another checkout.</p>
<p>If you want to create a new branch to retain commits you create, you may<br>do so (now or later) by using -b with the checkout command again. Example:<br><figure class="highlight haml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">  git checkout -b new\_branch\_name</div><div class="line"></div><div class="line">=<span class="ruby">=&gt; Checking out tag r3.<span class="number">0</span>.<span class="number">6</span></span></div><div class="line">=<span class="ruby">=&gt; ./build.sh</span></div><div class="line">=<span class="ruby">=&gt; /usr/local/opt/scons/bin/scons install --prefix=<span class="regexp">/usr/local</span><span class="regexp">/Cellar/mongodb</span><span class="regexp">/3.0.6 -j8 --osx-version-min=10.10 --cc=</span></span></div><div class="line">=<span class="ruby"><span class="regexp">=&gt; Caveats</span></span></div><div class="line">To have launchd start mongodb at login:</div><div class="line">  ln -sfv /usr/local/opt/mongodb/\*.plist \~/Library/LaunchAgents</div><div class="line">Then to load mongodb now:</div><div class="line">  launchctl load \~/Library/LaunchAgents/homebrew.mxcl.mongodb.plist</div><div class="line">Or, if you don't want/need launchctl, you can just run:</div><div class="line">  mongod --config /usr/local/etc/mongod.conf</div><div class="line">=<span class="ruby"><span class="regexp">=&gt; Summary</span></span></div><div class="line">🍺  /usr/local/Cellar/mongodb/3.0.6: 17 files, 158M, built in 7.2 minutes</div></pre></td></tr></table></figure></p>
<p>看起来通过Homebrew的bottle来安装失败，于是开始下载源代码来编译，最终安装成功。</p>
<h4 id="3-启动MongoDB"><a href="#3-启动MongoDB" class="headerlink" title="3.启动MongoDB"></a>3.启动MongoDB</h4><p>按照Terminal中的提示，直接启动MongoDB。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span><span class="bash"> mongod --config /usr/<span class="built_in">local</span>/etc/mongod.conf</span></div></pre></td></tr></table></figure>
<p>通过Terminal直接连接MongoDB。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span><span class="bash"> mongo</span></div><div class="line">MongoDB shell version: 3.0.6</div><div class="line">connecting to: test</div><div class="line"><span class="meta">&gt;</span><span class="bash"></span></div></pre></td></tr></table></figure>
<hr>
<p><strong>Ref:</strong></p>
<p><a href="http://docs.mongodb.org/manual/tutorial/install-mongodb-on-os-x/" target="_blank" rel="external">http://docs.mongodb.org/manual/tutorial/install-mongodb-on-os-x/</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/8/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/page/10/">10</a><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/10/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Calios</p>
              <div class="site-description motion-element" itemprop="description">Stedfast as thou art.</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">97</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">7</span>
                    <span class="site-state-item-name">tags</span>
                  
                </div>
              
            </nav>
          

          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/caliosd" title="GitHub &rarr; https://github.com/caliosd" rel="noopener" target="_blank"><i class="fa fa-fw fa-globe"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://www.instagram.com/calios_1124" title="Instagram &rarr; https://www.instagram.com/calios_1124" rel="noopener" target="_blank"><i class="fa fa-fw fa-globe"></i>Instagram</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2015 – <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">CaliosD</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.3.7</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.2.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=3.4.1"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/utils.js?v=7.2.0"></script>

  <script src="/js/motion.js?v=7.2.0"></script>



  
  


  <script src="/js/affix.js?v=7.2.0"></script>

  <script src="/js/schemes/pisces.js?v=7.2.0"></script>




  

  


  <script src="/js/next-boot.js?v=7.2.0"></script>


  

  

  

  



  




  

  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
