<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 【Bash】lsof——Mac查看端口占用情况 · Calios' Eden</title><meta name="description" content="【Bash】lsof——Mac查看端口占用情况 - Calios"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/img/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://www.calios.gq/atom.xml" title="Calios' Eden"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/img/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link active">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/calios1124" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/caliosd" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">ABOUT</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">【Bash】lsof——Mac查看端口占用情况</h1><div class="post-info">2015年9月18日</div><div class="post-tags"><a href="/tags/Bash/" class="post-tag"> Bash</a><a href="/tags/Mac/" class="post-tag"> Mac</a></div><div class="post-content"><h4 id="Issue"><a href="#Issue" class="headerlink" title="Issue"></a>Issue</h4><p>在本地通过Node.js起了一个服务来监听3000端口，在Terminal执行<code>node index.js</code> 后对该文件进行修改，而后<strong>直接</strong>再次执行<code>node index.js</code>。报如下错误：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="string">Gulugulu:</span>myapp calios$ node index.js</div><div class="line">events.<span class="string">js:</span><span class="number">85</span></div><div class="line">	  <span class="keyword">throw</span> er; <span class="comment">// Unhandled 'error' event</span></div><div class="line">	        ^</div><div class="line"><span class="string">Error:</span> listen EADDRINUSE</div><div class="line">	at exports._errnoException (util.<span class="string">js:</span><span class="number">746</span>:<span class="number">11</span>)</div><div class="line">	at Server._listen2 (net.<span class="string">js:</span><span class="number">1156</span>:<span class="number">14</span>)</div><div class="line">	at listen (net.<span class="string">js:</span><span class="number">1182</span>:<span class="number">10</span>)</div><div class="line">	at Server.listen (net.<span class="string">js:</span><span class="number">1267</span>:<span class="number">5</span>)</div><div class="line">	at EventEmitter.listen (<span class="regexp">/Users/</span>calios<span class="regexp">/Documents/</span>MyWorkspace<span class="regexp">/Front/</span>Node<span class="regexp">/myapp/</span>node_modules<span class="regexp">/express/</span>lib/application.<span class="string">js:</span><span class="number">617</span>:<span class="number">24</span>)</div><div class="line">	at Object.&lt;anonymous&gt; (<span class="regexp">/Users/</span>calios<span class="regexp">/Documents/</span>MyWorkspace<span class="regexp">/Front/</span>Node<span class="regexp">/myapp/</span>index.<span class="string">js:</span><span class="number">10</span>:<span class="number">18</span>)</div><div class="line">	at Module._compile (module.<span class="string">js:</span><span class="number">460</span>:<span class="number">26</span>)</div><div class="line">	at Object.Module._extensions..js (module.<span class="string">js:</span><span class="number">478</span>:<span class="number">10</span>)</div><div class="line">	at Module.load (module.<span class="string">js:</span><span class="number">355</span>:<span class="number">32</span>)</div><div class="line">	at Function.Module._load (module.<span class="string">js:</span><span class="number">310</span>:<span class="number">12</span>)</div></pre></td></tr></table></figure>
<h4 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h4><p>首先查看<code>3000</code>端口是否已被占用。</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ lsof -i :<span class="number">3000</span> (<span class="number">3000</span>可替换为其他想查看的端口号)</div><div class="line">COMMAND   PID   <span class="keyword">USER</span>   <span class="title">FD</span>   <span class="keyword">TYPE</span>             DEVICE SIZE/OFF <span class="keyword">NODE</span> <span class="title">NAME</span></div><div class="line"><span class="keyword">node</span>    <span class="title">48002</span> calios   <span class="number">14</span>u  IPv6 <span class="number">0</span>x9534c78c493eedc3      <span class="number">0</span>t0  TCP \*:hbci (LISTEN)</div></pre></td></tr></table></figure>
<p>发现正是刚才node起来的服务正在占用，kill掉这个<code>PID</code>为<code>48002</code>的家伙。</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ kill <span class="number">-9</span> <span class="number">48002</span></div></pre></td></tr></table></figure>
<p>此时再执行<code>node index.js</code>就不会报错了。</p>
<h4 id="More"><a href="#More" class="headerlink" title="More"></a>More</h4><h5 id="lsof-list-open-files"><a href="#lsof-list-open-files" class="headerlink" title="lsof(list open files)"></a>lsof(list open files)</h5><blockquote>
<p>Lsof lists on its standard output file information about files opened by processes.</p>
<p>An open file may be a regular file, a directory, a block special file, a character special  file,  an executing  text  reference,  a library, a stream or a network file (Internet socket, NFS file or UNIX domain socket.)  A specific file or all the files in a file system may be selected by path.</p>
<p>-i [i]  selects the listing of files any of whose Internet address matches the address specified  in i.   If  no  address  is specified, this option selects the listing of all Internet and x.25(HP-UX) network files.<br> [46][protocol][@hostname|hostaddr][:service|port]</p>
</blockquote>
<p>And here’s some functional commands.</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">lsof `which httpd`           <span class="comment">//那个进程在使用apache的可执行文件</span></div><div class="line">lsof /etc/passwd             <span class="comment">//那个进程在占用/etc/passwd</span></div><div class="line">lsof /dev/hda6               <span class="comment">//那个进程在占用hda6</span></div><div class="line">lsof /dev/cdrom              <span class="comment">//那个进程在占用光驱</span></div><div class="line">lsof -c sendmail             <span class="comment">//查看sendmail进程的文件使用情况</span></div><div class="line">lsof -c courier -u ^zahn     <span class="comment">//显示出那些文件被以courier打头的进程打开，但是并不属于用户zahn</span></div><div class="line">lsof -<span class="selector-tag">p</span> <span class="number">30297</span>                <span class="comment">//显示那些文件被pid为30297的进程打开</span></div><div class="line">lsof -D /tmp                 <span class="comment">//显示所有在/tmp文件夹中打开的instance和文件的进程。但是symbol文件并不在列</span></div><div class="line"></div><div class="line">lsof -u1000                  <span class="comment">//查看uid是100的用户的进程的文件使用情况</span></div><div class="line">lsof -utony                  <span class="comment">//查看用户tony的进程的文件使用情况</span></div><div class="line">lsof -u^tony                 <span class="comment">//查看不是用户tony的进程的文件使用情况(^是取反的意思)</span></div><div class="line">lsof -<span class="selector-tag">i</span>                      <span class="comment">//显示所有打开的端口</span></div><div class="line">lsof -<span class="selector-tag">i</span>:<span class="number">80</span>                   <span class="comment">//显示所有打开80端口的进程</span></div><div class="line">lsof -<span class="selector-tag">i</span> -U                   <span class="comment">//显示所有打开的端口和UNIX domain文件</span></div><div class="line">lsof -<span class="selector-tag">i</span> UDP@[url]www<span class="selector-class">.akadia</span><span class="selector-class">.com</span>:<span class="number">123</span>     <span class="comment">//显示那些进程打开了到www.akadia.com的UDP的123(ntp)端口的链接</span></div><div class="line">lsof -<span class="selector-tag">i</span> tcp@ohaha<span class="selector-class">.ks</span><span class="selector-class">.edu</span><span class="selector-class">.tw</span>:ftp -r      <span class="comment">//不断查看目前ftp连接的情况(-r，lsof会永远不断的执行，直到收到中断信号,+r，lsof会一直执行，直到没有档案被显示,缺省是15s刷新)</span></div><div class="line">lsof -<span class="selector-tag">i</span> tcp@ohaha<span class="selector-class">.ks</span><span class="selector-class">.edu</span><span class="selector-class">.tw</span>:ftp -n      <span class="comment">//lsof -n 不将IP转换为hostname，缺省是不加上-n参数</span></div></pre></td></tr></table></figure>
<hr>
<p><strong>Ref:</strong></p>
<p><a href="http://www.cnblogs.com/ggjucheng/archive/2012/01/08/2316599.html" target="_blank" rel="external">http://www.cnblogs.com/ggjucheng/archive/2012/01/08/2316599.html</a></p>
</div></article></div></section><footer><div class="paginator"><a href="/2015/09/24/AVPlayer-Class-Reference/" class="prev">PREV</a><a href="/2015/09/17/【转】iOS9-HTTP-不能正常使用的解决办法/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2017 <a href="http://www.calios.gq">Calios</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>