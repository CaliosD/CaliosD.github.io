<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> CAS登录之iOS端总结 · Calios' Eden</title><meta name="description" content="CAS登录之iOS端总结 - Calios"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/img/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://www.calios.gq/atom.xml" title="Calios' Eden"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/img/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/calios1124" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/caliosd" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">ABOUT</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">CAS登录之iOS端总结</h1><div class="post-info">2017年4月12日</div><div class="post-content"><p>CAS（集中式认证服务，Central Authentication Service）登录在后台开发中使用很广泛，它可以允许一个用户访问多个web app，而只需要提供一次凭证（如用户名和密码）。不仅方便用户跨程序使用系统，也实现了认证和web app分类，提高了安全性。</p>
<p>目前在移动端（本文以iOS为例）涉及到CAS登录的项目主要有两种实现方式：CAS模拟登录和RESTful方式的登录。现总结如下，供以后备查。</p>
<a id="more"></a>
<h3 id="1-CAS模拟登录"><a href="#1-CAS模拟登录" class="headerlink" title="1 CAS模拟登录"></a>1 CAS模拟登录</h3><p>这种方式相当于模拟登录web端，在请求回web app的登录页面后，返回CAS登录页面，从中获取lt和execution，请求CAS登录接口时，带上service=BaseURL/web-name/shiro-cas，通过这个操作判断是否登录，如果登录，就在web server中种入session，使得之后移动端调用web server的接口可以生效。</p>
<p><strong>1.1 使用的项目</strong></p>
<p>CAS不被公司拥有的、无法提供Restful方式的项目接口。</p>
<p><strong>1.2 登录流程示意图</strong></p>
<p><img src="http://7xkwcv.com1.z0.glb.clouddn.com/CAS%E6%A8%A1%E6%8B%9F%E7%99%BB%E5%BD%95%E6%B5%81%E7%A8%8B%E7%A4%BA%E6%84%8F%E5%9B%BE-%E8%84%B1%E6%95%8F.jpg" alt="CAS模拟登录示意图"></p>
<p>注：</p>
<ul>
<li>Step1为GET，Step2、3为POST。</li>
<li>Step2的j_captcha_response即为验证码。</li>
<li>请求验证码一步非必需。</li>
</ul>
<h3 id="RESTful方式"><a href="#RESTful方式" class="headerlink" title="RESTful方式"></a>RESTful方式</h3><p>可以使用Github上的开源demo（<a href="https://github.com/acu-dev/objc-cas-client）实现，也可以直接使用AFNetworking实现。本质上流程完全相同。" target="_blank" rel="external">https://github.com/acu-dev/objc-cas-client）实现，也可以直接使用AFNetworking实现。本质上流程完全相同。</a></p>
<p><strong>2.1 登录流程示意图</strong></p>
<p><img src="http://7xkwcv.com1.z0.glb.clouddn.com/CAS%E7%99%BB%E5%BD%95RESTful%E6%B5%81%E7%A8%8B%E7%A4%BA%E6%84%8F%E5%9B%BE-%E8%84%B1%E6%95%8F.jpg" alt="RESTful方式"></p>
<p>注：</p>
<ul>
<li>Step1、2、3均为POST。</li>
</ul>
<p><strong>2.3 技术细节：</strong></p>
<ul>
<li>Step1：请求TGT时 server路径形如：<a href="http://xxx.xxx.xxx.xxx/cas/v1/tickets/" target="_blank" rel="external">http://xxx.xxx.xxx.xxx/cas/v1/tickets/</a> 。需要传递账号密码参数给CAS，形如： account=somebody&amp;password=password。TGT请求成功时响应状态码为201，并且包含Location字段，形如：Location: <a href="http://www.whatever.com/cas/v1/tickets/{TGT" target="_blank" rel="external">http://www.whatever.com/cas/v1/tickets/{TGT</a> id}，然后截取TGT并保存。</li>
<li>Step2：根据TGT 请求ST server路径形如：<a href="http://xxx.xxx.xxx.xxx//cas/v1/tickets/TGT-xxxxxxxxx。参数形如：service=http://localhost:8080/web-name，成功后保存返回的ST。" target="_blank" rel="external">http://xxx.xxx.xxx.xxx//cas/v1/tickets/TGT-xxxxxxxxx。参数形如：service=http://localhost:8080/web-name，成功后保存返回的ST。</a></li>
<li>Step3：调用WebServer登录接口需要将获得的ST作为参数传递，形如：cas-service-ticket=ST-xxxxxxxxx.</li>
<li>登出CAS请求（DELETE）形如：<a href="http://xxx.xxx.xxx.xxx/cas/v1/tickets/TGT-xxxxxxxxx。然后向WebServer发起POST登出请求（即调用接口" target="_blank" rel="external">http://xxx.xxx.xxx.xxx/cas/v1/tickets/TGT-xxxxxxxxx。然后向WebServer发起POST登出请求（即调用接口</a> /web-name/logout） 成功后判定为整个登出流程完成。</li>
</ul>
<h3 id="参考资料："><a href="#参考资料：" class="headerlink" title="参考资料："></a>参考资料：</h3><ul>
<li>CAS原理介绍：<a href="http://p.primeton.com/articles/53c64e25e13823319f000068" target="_blank" rel="external">http://p.primeton.com/articles/53c64e25e13823319f000068</a></li>
<li>CAS认证的说明：<a href="https://www.purdue.edu/apps/account/html/cas_presentation_20110407.pdf" target="_blank" rel="external">https://www.purdue.edu/apps/account/html/cas_presentation_20110407.pdf</a></li>
<li>iOS开源Demo：<a href="https://github.com/acu-dev/objc-cas-client" target="_blank" rel="external">https://github.com/acu-dev/objc-cas-client</a></li>
<li>Jasig CAS RESTful API：<a href="https://wiki.jasig.org/display/CASUM/RESTful+API" target="_blank" rel="external">https://wiki.jasig.org/display/CASUM/RESTful+API</a></li>
<li>REST Protocol：<a href="https://apereo.github.io/cas/4.2.x/protocol/REST-Protocol.html" target="_blank" rel="external">https://apereo.github.io/cas/4.2.x/protocol/REST-Protocol.html</a></li>
</ul>
</div></article></div></main><footer><div class="paginator"><a href="/2017/03/22/GPS-and-related/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2017 <a href="http://www.calios.gq">Calios</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>